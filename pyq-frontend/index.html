<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœ‹å‹åœˆè‡ªåŠ¨å‘å¸ƒç³»ç»Ÿ - ç®¡ç†åå°</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #f0f2f5;
        }

        .app-container {
            display: flex;
            height: 100vh;
        }

        /* ä¾§è¾¹æ æ ·å¼ - æ¸…çˆ½ç™½è‰²é£æ ¼ */
        .sidebar {
            width: 256px;
            background: white;
            border-right: 1px solid #e8e8e8;
            display: flex;
            flex-direction: column;
        }

        .logo {
            height: 64px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: bold;
            color: #0052CC;
            background: white;
            border-bottom: 1px solid #e8e8e8;
        }

        .menu {
            flex: 1;
            padding: 16px 0;
        }

        .menu-item {
            padding: 12px 24px;
            margin: 4px 12px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 12px;
            color: #666;
            border-radius: 8px;
        }

        .menu-item:hover {
            background: #E6F4FF;
            color: #0052CC;
        }

        .menu-item.active {
            background: #0052CC;
            color: white;
        }

        .menu-icon {
            font-size: 18px;
        }

        /* åˆ†çº§èœå•æ ·å¼ */
        .menu-group {
            margin: 4px 0;
        }

        .menu-group-title {
            padding: 12px 24px;
            margin: 4px 12px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: space-between;
            color: #666;
            border-radius: 8px;
            font-weight: 500;
        }

        .menu-group-title:hover {
            background: #E6F4FF;
            color: #0052CC;
        }

        .menu-group-title.active {
            background: #E6F4FF;
            color: #0052CC;
        }

        .menu-group-icon {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .menu-arrow {
            font-size: 12px;
            transition: transform 0.3s;
        }

        .menu-arrow.expanded {
            transform: rotate(90deg);
        }

        .submenu {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .submenu.expanded {
            max-height: 500px;
        }

        .submenu-item {
            padding: 10px 24px 10px 56px;
            margin: 2px 12px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            color: #666;
            border-radius: 6px;
            font-size: 14px;
        }

        .submenu-item:hover {
            background: #E6F4FF;
            color: #0052CC;
        }

        .submenu-item.active {
            background: #0052CC;
            color: white;
        }

        /* ä¾§è¾¹æ åº•éƒ¨ç‰ˆæœ¬ä¿¡æ¯ */
        .sidebar-footer {
            padding: 16px 24px;
            border-top: 1px solid #f0f0f0;
            text-align: center;
            color: #999;
            font-size: 12px;
        }

        /* ä¸»å†…å®¹åŒºåŸŸ */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* é¡¶éƒ¨å¯¼èˆªæ  */
        .header {
            height: 64px;
            background: white;
            box-shadow: 0 1px 4px rgba(0,21,41,.08);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 24px;
        }

        .header-title {
            font-size: 18px;
            font-weight: 500;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #0052CC;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        /* å†…å®¹åŒºåŸŸ */
        .content {
            flex: 1;
            padding: 24px;
            overflow-y: auto;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* å¡ç‰‡æ ·å¼ */
        .card {
            background: white;
            border-radius: 8px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.03);
        }

        .card-title {
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid #f0f0f0;
        }

        /* ç»Ÿè®¡å¡ç‰‡ - æ¸…çˆ½è“è‰²é£æ ¼ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 24px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: linear-gradient(135deg, #E6F4FF 0%, #ffffff 100%);
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0,82,204,0.08);
            border: 1px solid #E6F4FF;
        }

        .stat-label {
            color: #666;
            font-size: 14px;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: #0052CC;
        }

        .stat-trend {
            font-size: 12px;
            color: #0052CC;
            margin-top: 8px;
        }

        /* è¡¨å•æ ·å¼ */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
        }

        .form-input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #d9d9d9;
            border-radius: 4px;
            font-size: 14px;
            transition: all 0.3s;
        }

        .form-input:focus {
            outline: none;
            border-color: #0052CC;
            box-shadow: 0 0 0 2px rgba(0, 82, 204, 0.2);
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }

        /* å›¾ç‰‡ç¼–è¾‘å™¨æ ·å¼ */
        .image-editor {
            margin-top: 20px;
        }

        .image-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 10px;
        }

        .image-item {
            position: relative;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
            background: #f9f9f9;
        }

        .image-item img {
            width: 100%;
            height: 150px;
            object-fit: cover;
            display: block;
        }

        .image-controls {
            position: absolute;
            top: 5px;
            right: 5px;
            display: flex;
            gap: 5px;
        }

        .image-btn {
            width: 28px;
            height: 28px;
            border: none;
            border-radius: 4px;
            background: rgba(0, 0, 0, 0.6);
            color: white;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .image-btn:hover {
            background: rgba(0, 0, 0, 0.8);
        }

        .image-order {
            position: absolute;
            bottom: 5px;
            left: 5px;
            background: rgba(0, 0, 0, 0.6);
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 12px;
        }

        .add-image-btn {
            width: 100%;
            height: 150px;
            border: 2px dashed #d0d0d0;
            border-radius: 8px;
            background: #f9f9f9;
            color: #999;
            cursor: pointer;
            font-size: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .add-image-btn:hover {
            border-color: #0052CC;
            color: #0052CC;
            background: #f0f7ff;
        }

        /* æŒ‰é’®æ ·å¼ - æ·±è“è‰²ä¸»é¢˜ */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }

        .btn-primary {
            background: #0052CC;
            color: white;
        }

        .btn-primary:hover {
            background: #0065FF;
            box-shadow: 0 4px 12px rgba(0,82,204,0.3);
        }

        .btn-success {
            background: #0052CC;
            color: white;
        }

        .btn-success:hover {
            background: #0065FF;
            box-shadow: 0 4px 12px rgba(0,82,204,0.3);
        }

        .btn-danger {
            background: #ff4d4f;
            color: white;
        }

        .btn-danger:hover {
            background: #ff7875;
        }

        /* è¡¨æ ¼æ ·å¼ */
        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th,
        .table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #f0f0f0;
        }

        .table th {
            background: #fafafa;
            font-weight: 500;
            color: #333;
        }

        .table tr:hover {
            background: #fafafa;
        }

        /* æ ‡ç­¾æ ·å¼ */
        .tag {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 12px;
        }

        .tag-success {
            background: #f6ffed;
            color: #52c41a;
            border: 1px solid #b7eb8f;
        }

        .tag-warning {
            background: #fffbe6;
            color: #faad14;
            border: 1px solid #ffe58f;
        }

        .tag-danger {
            background: #fff2f0;
            color: #ff4d4f;
            border: 1px solid #ffccc7;
        }

        .tag-info {
            background: #E6F4FF;
            color: #0052CC;
            border: 1px solid #91d5ff;
        }

        /* å›¾ç‰‡é¢„è§ˆ */
        .image-preview {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin-top: 12px;
        }

        .image-item {
            width: 100px;
            height: 100px;
            border-radius: 4px;
            object-fit: cover;
            border: 1px solid #d9d9d9;
        }

        /* ç©ºçŠ¶æ€ */
        .empty-state {
            text-align: center;
            padding: 60px 0;
            color: #999;
        }

        .empty-icon {
            font-size: 64px;
            margin-bottom: 16px;
        }

        /* iframeå®¹å™¨æ ·å¼ - æ— ç¼é›†æˆ */
        .iframe-container {
            width: 100%;
            height: calc(100vh - 64px);  /* å‡å»é¡¶éƒ¨å¯¼èˆªæ é«˜åº¦ */
            border: none;
            overflow: hidden;
            position: relative;
        }

        .iframe-container iframe {
            width: 100%;
            height: 100%;
            border: none;
            display: block;
            background: #f0f2f5;
        }

        /* æ¨¡æ€æ¡†æ ·å¼ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            max-width: 90%;
            max-height: 90vh;
            overflow: auto;
        }

        .modal-header {
            padding: 20px 24px;
            border-bottom: 1px solid #e8e8e8;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: all 0.3s;
        }

        .modal-close:hover {
            background: #f5f5f5;
            color: #333;
        }

        .modal-body {
            padding: 24px;
        }

        .modal-footer {
            padding: 16px 24px;
            border-top: 1px solid #e8e8e8;
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        /* åŠ è½½åŠ¨ç”» */
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #0052CC;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ========================================
           å“åº”å¼è®¾è®¡ - ç§»åŠ¨ç«¯é€‚é…
           ======================================== */

        /* æ±‰å ¡èœå•æŒ‰é’® (é»˜è®¤éšè—) */
        .mobile-menu-btn {
            display: none;
            position: fixed;
            top: 16px;
            left: 16px;
            z-index: 1001;
            width: 44px;
            height: 44px;
            background: white;
            border: 1px solid #e8e8e8;
            border-radius: 8px;
            cursor: pointer;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 4px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .mobile-menu-btn span {
            width: 20px;
            height: 2px;
            background: #0052CC;
            transition: all 0.3s;
        }

        .mobile-menu-btn.active span:nth-child(1) {
            transform: rotate(45deg) translate(5px, 5px);
        }

        .mobile-menu-btn.active span:nth-child(2) {
            opacity: 0;
        }

        .mobile-menu-btn.active span:nth-child(3) {
            transform: rotate(-45deg) translate(5px, -5px);
        }

        /* é®ç½©å±‚ (é»˜è®¤éšè—) */
        .sidebar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 999;
        }

        /* å¹³æ¿è®¾å¤‡ (768px - 1024px) */
        @media (max-width: 1024px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .content {
                padding: 16px;
            }

            .card {
                padding: 16px;
            }
        }

        /* ç§»åŠ¨è®¾å¤‡ (< 768px) */
        @media (max-width: 768px) {
            /* æ˜¾ç¤ºæ±‰å ¡èœå•æŒ‰é’® */
            .mobile-menu-btn {
                display: flex;
            }

            /* ä¾§è¾¹æ é»˜è®¤éšè—,å˜æˆæŠ½å±‰å¼ */
            .sidebar {
                position: fixed;
                top: 0;
                left: -256px;
                height: 100vh;
                z-index: 1000;
                transition: left 0.3s ease;
                box-shadow: 2px 0 8px rgba(0,0,0,0.15);
            }

            .sidebar.active {
                left: 0;
            }

            /* æ˜¾ç¤ºé®ç½©å±‚ */
            .sidebar-overlay.active {
                display: block;
            }

            /* å†…å®¹åŒºåŸŸå æ»¡å…¨å± */
            .content {
                width: 100%;
                padding: 72px 12px 12px 12px; /* é¡¶éƒ¨ç•™ç©ºç»™æ±‰å ¡èœå• */
            }

            /* ç»Ÿè®¡å¡ç‰‡å•åˆ—æ˜¾ç¤º */
            .stats-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }

            .stat-card {
                padding: 16px;
            }

            .stat-value {
                font-size: 24px;
            }

            /* å¡ç‰‡æ ·å¼ä¼˜åŒ– */
            .card {
                padding: 12px;
                margin-bottom: 12px;
                border-radius: 6px;
            }

            .card-title {
                font-size: 14px;
                margin-bottom: 12px;
                padding-bottom: 8px;
            }

            /* è¡¨å•ä¼˜åŒ– */
            .form-group {
                margin-bottom: 16px;
            }

            .form-input {
                padding: 12px;
                font-size: 16px; /* é˜²æ­¢iOSè‡ªåŠ¨ç¼©æ”¾ */
            }

            /* æŒ‰é’®ä¼˜åŒ– */
            .btn {
                padding: 12px 20px;
                font-size: 14px;
                min-height: 44px; /* è§¦æ‘¸å‹å¥½ */
            }

            /* è¡¨æ ¼ä¼˜åŒ– */
            .table-container {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            table {
                min-width: 600px;
            }

            /* èœå•é¡¹ä¼˜åŒ– */
            .menu-item {
                padding: 14px 20px;
                margin: 6px 12px;
                font-size: 15px;
            }

            .menu-icon {
                font-size: 20px;
            }

            /* Logoä¼˜åŒ– */
            .logo {
                height: 56px;
                font-size: 18px;
            }

            /* ç”¨æˆ·ä¿¡æ¯ä¼˜åŒ– */
            .user-info {
                padding: 12px 20px;
            }
        }

        /* å°å±æ‰‹æœº (< 375px) */
        @media (max-width: 375px) {
            .content {
                padding: 68px 8px 8px 8px;
            }

            .stat-value {
                font-size: 20px;
            }

            .card {
                padding: 10px;
            }

            .btn {
                padding: 10px 16px;
                font-size: 13px;
            }
        }
    </style>
</head>
<body>
    <div id="app" class="app-container">
        <!-- æ±‰å ¡èœå•æŒ‰é’® (ç§»åŠ¨ç«¯) -->
        <button class="mobile-menu-btn" @click="toggleMobileMenu" :class="{active: mobileMenuOpen}">
            <span></span>
            <span></span>
            <span></span>
        </button>

        <!-- é®ç½©å±‚ (ç§»åŠ¨ç«¯) -->
        <div class="sidebar-overlay" :class="{active: mobileMenuOpen}" @click="closeMobileMenu"></div>

        <!-- ä¾§è¾¹æ  -->
        <div class="sidebar" :class="{active: mobileMenuOpen}">
            <div class="logo">
                ğŸš€ æœ‹å‹åœˆå‘å¸ƒç³»ç»Ÿ
            </div>
            <div class="menu">
                <!-- è‡ªåŠ¨æ¨¡å¼ -->
                <div class="menu-item" :class="{active: currentPage === 'auto-workflow'}" @click="currentPage = 'auto-workflow'; closeMobileMenu()">
                    <span>è‡ªåŠ¨æ¨¡å¼</span>
                </div>

                <!-- æ‰‹åŠ¨æ¨¡å¼ -->
                <div class="menu-group">
                    <div class="menu-group-title" :class="{active: menuGroups.manual}" @click="toggleMenuGroup('manual')">
                        <div class="menu-group-icon">
                            <span>æ‰‹åŠ¨æ¨¡å¼</span>
                        </div>
                        <span class="menu-arrow" :class="{expanded: menuGroups.manual}">â–¶</span>
                    </div>
                    <div class="submenu" :class="{expanded: menuGroups.manual}">
                        <div class="submenu-item" :class="{active: currentPage === 'collection'}" @click="currentPage = 'collection'; closeMobileMenu()">
                            <span>å…¬ä¼—å·æå–</span>
                        </div>
                        <div class="submenu-item" :class="{active: currentPage === 'rewrite'}" @click="currentPage = 'rewrite'; closeMobileMenu()">
                            <span>æ–‡æ¡ˆè½¬å†™</span>
                        </div>
                        <div class="submenu-item" :class="{active: currentPage === 'publish'}" @click="currentPage = 'publish'; closeMobileMenu()">
                            <span>è‡ªåŠ¨å‘å¸ƒ</span>
                        </div>
                    </div>
                </div>

                <!-- å…¬ä¼—å·ç›‘æ§ -->
                <div class="menu-item" :class="{active: currentPage === 'wechat-monitor'}" @click="currentPage = 'wechat-monitor'; closeMobileMenu()">
                    <span>å…¬ä¼—å·ç›‘æ§</span>
                </div>

                <!-- ä»ªè¡¨ç›˜ -->
                <div class="menu-item" :class="{active: currentPage === 'dashboard'}" @click="currentPage = 'dashboard'; closeMobileMenu()">
                    <span>ä»ªè¡¨ç›˜</span>
                </div>

                <!-- å †é›ªçƒè´¦å·è®¾ç½® -->
                <div class="menu-item" :class="{active: currentPage === 'accounts'}" @click="currentPage = 'accounts'; closeMobileMenu()">
                    <span>å †é›ªçƒè´¦å·è®¾ç½®</span>
                </div>

                <!-- APIé…ç½® -->
                <div class="menu-group">
                    <div class="menu-group-title" :class="{active: menuGroups.api}" @click="toggleMenuGroup('api')">
                        <div class="menu-group-icon">
                            <span>APIé…ç½®</span>
                        </div>
                        <span class="menu-arrow" :class="{expanded: menuGroups.api}">â–¶</span>
                    </div>
                    <div class="submenu" :class="{expanded: menuGroups.api}">
                        <div class="submenu-item" :class="{active: currentPage === 'coze-config'}" @click="currentPage = 'coze-config'">
                            <span>Cozeé…ç½®</span>
                        </div>
                        <div class="submenu-item" :class="{active: currentPage === 'feishu-config'}" @click="currentPage = 'feishu-config'">
                            <span>é£ä¹¦å¤šç»´è¡¨æ ¼</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ä¾§è¾¹æ åº•éƒ¨ç‰ˆæœ¬ä¿¡æ¯ -->
            <div class="sidebar-footer">
                V3.6.0 - è·Ÿåœˆè‡ªåŠ¨åŒ–
            </div>
        </div>

        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <div class="main-content">
            <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
            <div class="header">
                <div class="header-title">{{ pageTitle }}</div>
                <div class="user-info">
                    <span>{{ userName }}</span>
                    <div class="avatar">{{ userAvatar }}</div>
                    <button class="btn btn-logout" @click="handleLogout" style="margin-left: 12px; padding: 6px 12px; background: #ff4d4f; color: white; border: none; border-radius: 4px; cursor: pointer;">é€€å‡ºç™»å½•</button>
                </div>
            </div>

            <!-- å†…å®¹åŒºåŸŸ -->
            <div class="content">
                <!-- ä»ªè¡¨ç›˜é¡µé¢ -->
                <div class="page" :class="{active: currentPage === 'dashboard'}">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-label">ä»Šæ—¥é‡‡é›†</div>
                            <div class="stat-value">23</div>
                            <div class="stat-trend">â†‘ 12% è¾ƒæ˜¨æ—¥</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">ä»Šæ—¥æ”¹å†™</div>
                            <div class="stat-value">18</div>
                            <div class="stat-trend">â†‘ 8% è¾ƒæ˜¨æ—¥</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">ä»Šæ—¥å‘å¸ƒ</div>
                            <div class="stat-value">15</div>
                            <div class="stat-trend">â†‘ 15% è¾ƒæ˜¨æ—¥</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">æ´»è·ƒè´¦å·</div>
                            <div class="stat-value">8</div>
                            <div class="stat-trend">å…±10ä¸ªè´¦å·</div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-title">æœ€è¿‘å‘å¸ƒè®°å½•</div>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>æ–‡æ¡ˆå†…å®¹</th>
                                    <th>å‘å¸ƒè´¦å·</th>
                                    <th>å‘å¸ƒæ—¶é—´</th>
                                    <th>çŠ¶æ€</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>ä»Šå¤©å¤©æ°”çœŸå¥½ï¼Œé€‚åˆå‘æœ‹å‹åœˆï¼</td>
                                    <td>å¾®ä¿¡å·1</td>
                                    <td>2025-10-22 14:30</td>
                                    <td><span class="tag tag-success">å·²å‘å¸ƒ</span></td>
                                </tr>
                                <tr>
                                    <td>åˆ†äº«ä¸€ç¯‡å¥½æ–‡ç« ç»™å¤§å®¶</td>
                                    <td>å¾®ä¿¡å·2</td>
                                    <td>2025-10-22 13:15</td>
                                    <td><span class="tag tag-success">å·²å‘å¸ƒ</span></td>
                                </tr>
                                <tr>
                                    <td>å‘¨æœ«æ„‰å¿«ï¼</td>
                                    <td>å¾®ä¿¡å·3</td>
                                    <td>2025-10-22 10:00</td>
                                    <td><span class="tag tag-warning">å¾…å‘å¸ƒ</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- è‡ªåŠ¨æ¨¡å¼é¡µé¢ -->
                <div class="page" :class="{active: currentPage === 'auto-workflow'}">
                    <!-- è„šæœ¬é€‰æ‹©å¡ç‰‡ -->
                    <div class="card">
                        <div class="card-title">ğŸ¤– é€‰æ‹©è‡ªåŠ¨åŒ–è„šæœ¬</div>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 16px;">
                            <!-- è„šæœ¬1 -->
                            <div @click="autoForm.selectedScript = 'script1'"
                                 :style="{
                                     padding: '20px',
                                     border: autoForm.selectedScript === 'script1' ? '2px solid #0052CC' : '1px solid #ddd',
                                     borderRadius: '8px',
                                     cursor: 'pointer',
                                     background: autoForm.selectedScript === 'script1' ? '#E6F4FF' : 'white',
                                     transition: 'all 0.3s'
                                 }">
                                <div style="font-size: 18px; font-weight: bold; margin-bottom: 8px; color: #0052CC;">
                                    ğŸ“ è„šæœ¬1: è¾“å…¥é“¾æ¥è‡ªåŠ¨å‘å¸ƒ
                                </div>
                                <div style="color: #666; font-size: 14px; line-height: 1.6;">
                                    è¾“å…¥å…¬ä¼—å·æ–‡ç« é“¾æ¥,è‡ªåŠ¨å®Œæˆé‡‡é›†ã€è½¬å†™ã€å‘å¸ƒå…¨æµç¨‹
                                </div>
                            </div>

                            <!-- è„šæœ¬3 -->
                            <div @click="autoForm.selectedScript = 'script3'"
                                 :style="{
                                     padding: '20px',
                                     border: autoForm.selectedScript === 'script3' ? '2px solid #0052CC' : '1px solid #ddd',
                                     borderRadius: '8px',
                                     cursor: 'pointer',
                                     background: autoForm.selectedScript === 'script3' ? '#E6F4FF' : 'white',
                                     transition: 'all 0.3s'
                                 }">
                                <div style="font-size: 18px; font-weight: bold; margin-bottom: 8px; color: #0052CC;">
                                    â° è„šæœ¬3: å®šæ—¶ç›‘æ§è‡ªåŠ¨å‘å¸ƒ
                                </div>
                                <div style="color: #666; font-size: 14px; line-height: 1.6;">
                                    å®šæ—¶æ£€æŸ¥è®¢é˜…çš„å…¬ä¼—å·æ–°æ–‡ç« ,è‡ªåŠ¨è½¬å†™å¹¶å‘å¸ƒ
                                </div>
                            </div>

                            <!-- è„šæœ¬4 -->
                            <div @click="autoForm.selectedScript = 'script4'"
                                 :style="{
                                     padding: '20px',
                                     border: autoForm.selectedScript === 'script4' ? '2px solid #0052CC' : '1px solid #ddd',
                                     borderRadius: '8px',
                                     cursor: 'pointer',
                                     background: autoForm.selectedScript === 'script4' ? '#E6F4FF' : 'white',
                                     transition: 'all 0.3s'
                                 }">
                                <div style="font-size: 18px; font-weight: bold; margin-bottom: 8px; color: #0052CC;">
                                    ğŸ”„ è„šæœ¬4: è·Ÿåœˆè‡ªåŠ¨åŒ–
                                </div>
                                <div style="color: #666; font-size: 14px; line-height: 1.6;">
                                    è‡ªåŠ¨å‘å¸ƒå¤šæ¡ç›¸åŒå†…å®¹çš„æœ‹å‹åœˆ,å¹¶å®šæ—¶åˆ é™¤æ—§æœ‹å‹åœˆ
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- è„šæœ¬1é…ç½® -->
                    <div class="card" v-if="autoForm.selectedScript === 'script1'">
                        <div class="card-title">ğŸ“ è„šæœ¬1: è¾“å…¥é“¾æ¥è‡ªåŠ¨å‘å¸ƒ</div>

                        <div class="form-group">
                            <label class="form-label">* å…¬ä¼—å·æ–‡ç« é“¾æ¥</label>
                            <input type="text" class="form-input" v-model="autoForm.script1.url"
                                   placeholder="è¯·è¾“å…¥å…¬ä¼—å·æ–‡ç« é“¾æ¥" :disabled="autoForm.script1Loading"
                                   autocomplete="off">
                        </div>

                        <div class="form-group">
                            <label class="form-label">å‘å¸ƒæ—¶é—´</label>
                            <div style="display: flex; gap: 16px; align-items: center;">
                                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                    <input type="radio" v-model="autoForm.script1.isImmediate" :value="true" :disabled="autoForm.script1Loading">
                                    <span>ç«‹å³å‘å¸ƒ</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                    <input type="radio" v-model="autoForm.script1.isImmediate" :value="false" :disabled="autoForm.script1Loading">
                                    <span>å®šæ—¶å‘å¸ƒ</span>
                                </label>
                            </div>
                            <input v-if="!autoForm.script1.isImmediate" type="datetime-local" class="form-input"
                                   v-model="autoForm.script1.publishTime" style="margin-top: 10px;" :disabled="autoForm.script1Loading">
                        </div>

                        <div class="form-group">
                            <label class="form-label">å†…å®¹ç±»å‹</label>
                            <select class="form-input" v-model="autoForm.script1.contentType" :disabled="autoForm.script1Loading">
                                <option value="text">æ–‡æœ¬</option>
                                <option value="image">å›¾ç‰‡</option>
                                <option value="video">è§†é¢‘</option>
                                <option value="link">é“¾æ¥</option>
                            </select>
                        </div>

                        <button class="btn btn-primary" @click="executeScript1" :disabled="autoForm.script1Loading">
                            <span v-if="!autoForm.script1Loading">ğŸš€ æ‰§è¡Œè„šæœ¬</span>
                            <span v-else>â³ æ‰§è¡Œä¸­...</span>
                        </button>

                        <div style="margin-top: 16px; padding: 12px; background: #f5f5f5; border-radius: 4px; color: #666; font-size: 14px;">
                            <div style="font-weight: bold; margin-bottom: 8px;">ğŸ“‹ æ‰§è¡Œæµç¨‹:</div>
                            <div>1ï¸âƒ£ è‡ªåŠ¨é‡‡é›†æ–‡ç« å†…å®¹å’Œå›¾ç‰‡</div>
                            <div>2ï¸âƒ£ è‡ªåŠ¨è°ƒç”¨Coze AIè½¬å†™3ä¸ªç‰ˆæœ¬</div>
                            <div>3ï¸âƒ£ è‡ªåŠ¨é€‰æ‹©ç‰ˆæœ¬1åˆ›å»ºå‘å¸ƒä»»åŠ¡</div>
                            <div>4ï¸âƒ£ è‡ªåŠ¨è®¾ç½®å‘å¸ƒæ—¶é—´</div>
                            <div>5ï¸âƒ£ è‡ªåŠ¨æ‰§è¡Œå‘å¸ƒåˆ°å †é›ªçƒ</div>
                        </div>

                        <!-- å®æ—¶æ—¥å¿—è¾“å‡º -->
                        <div v-if="autoForm.script1Logs.length > 0" class="card" style="margin-top: 20px; background: #1e1e1e; border: 1px solid #333;">
                            <div style="font-weight: bold; color: #4CAF50; margin-bottom: 12px; font-family: 'Courier New', monospace;">
                                ğŸ“Š æ‰§è¡Œæ—¥å¿—
                            </div>
                            <div style="max-height: 400px; overflow-y: auto; font-family: 'Courier New', monospace; font-size: 13px;">
                                <div v-for="(log, index) in autoForm.script1Logs" :key="index"
                                     style="padding: 8px; margin-bottom: 4px; border-radius: 4px; background: #ffffff10; color: #ffffff;">
                                    {{ log }}
                                </div>
                            </div>
                        </div>

                        <!-- ğŸ”¥ ç§»é™¤é™æ€æ‰§è¡Œç»“æœæ˜¾ç¤º,æ”¹ç”¨å®æ—¶æ—¥å¿— -->
                    </div>

                    <!-- è„šæœ¬3é…ç½® -->
                    <div class="card" v-if="autoForm.selectedScript === 'script3'">
                        <div class="card-title">â° è„šæœ¬3: å®šæ—¶ç›‘æ§è‡ªåŠ¨å‘å¸ƒ</div>

                        <div class="form-group">
                            <label class="form-label">
                                <input type="checkbox" v-model="autoForm.script3.autoRewrite" :disabled="autoForm.script3Loading">
                                è‡ªåŠ¨è½¬å†™æ–‡æ¡ˆ
                            </label>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                <input type="checkbox" v-model="autoForm.script3.autoPublish" :disabled="autoForm.script3Loading">
                                è‡ªåŠ¨åˆ›å»ºå‘å¸ƒä»»åŠ¡
                            </label>
                        </div>

                        <div class="form-group" v-if="autoForm.script3.autoPublish">
                            <label class="form-label">å‘å¸ƒå»¶è¿Ÿ(åˆ†é’Ÿ)</label>
                            <input type="number" class="form-input" v-model.number="autoForm.script3.publishDelay"
                                   placeholder="0è¡¨ç¤ºç«‹å³å‘å¸ƒ" min="0" :disabled="autoForm.script3Loading">
                        </div>

                        <div class="form-group">
                            <label class="form-label">å†…å®¹ç±»å‹</label>
                            <select class="form-input" v-model="autoForm.script3.contentType" :disabled="autoForm.script3Loading">
                                <option value="text">æ–‡æœ¬</option>
                                <option value="image">å›¾ç‰‡</option>
                                <option value="video">è§†é¢‘</option>
                                <option value="link">é“¾æ¥</option>
                            </select>
                        </div>

                        <button class="btn btn-primary" @click="executeScript3" :disabled="autoForm.script3Loading">
                            <span v-if="!autoForm.script3Loading">ğŸš€ æ‰§è¡Œè„šæœ¬</span>
                            <span v-else>â³ æ‰§è¡Œä¸­...</span>
                        </button>

                        <div style="margin-top: 16px; padding: 12px; background: #f5f5f5; border-radius: 4px; color: #666; font-size: 14px;">
                            <div style="font-weight: bold; margin-bottom: 8px;">ğŸ“‹ æ‰§è¡Œæµç¨‹:</div>
                            <div>1ï¸âƒ£ æ£€æŸ¥æœ€è¿‘1å°æ—¶å†…çš„æ–°æ–‡ç« </div>
                            <div>2ï¸âƒ£ è‡ªåŠ¨è½¬å†™æ–°æ–‡ç« (å¦‚æœå¯ç”¨)</div>
                            <div>3ï¸âƒ£ è‡ªåŠ¨åˆ›å»ºå‘å¸ƒä»»åŠ¡(å¦‚æœå¯ç”¨)</div>
                            <div>4ï¸âƒ£ æŒ‰è®¾ç½®çš„å»¶è¿Ÿæ—¶é—´å‘å¸ƒ</div>
                        </div>

                        <!-- ğŸ”¥ ç§»é™¤é™æ€æ‰§è¡Œç»“æœæ˜¾ç¤º,æ”¹ç”¨å®æ—¶æ—¥å¿— -->
                    </div>

                    <!-- è„šæœ¬4é…ç½® -->
                    <div class="card" v-if="autoForm.selectedScript === 'script4'">
                        <div class="card-title">ğŸ”„ è„šæœ¬4: è·Ÿåœˆè‡ªåŠ¨åŒ–</div>

                        <div class="form-group">
                            <label class="form-label">* æœ‹å‹åœˆå†…å®¹</label>
                            <textarea class="form-input" v-model="autoForm.script4.content"
                                      placeholder="è¯·è¾“å…¥æœ‹å‹åœˆæ–‡å­—å†…å®¹" rows="5"
                                      style="resize: vertical;"></textarea>
                        </div>

                        <div class="form-group">
                            <label class="form-label">ä¸Šä¼ å›¾ç‰‡ (æœ€å¤š9å¼ )</label>
                            <input type="file" multiple accept="image/*" @change="handleScript4ImageUpload"
                                   style="display: none;" ref="script4ImageInput">
                            <button class="btn" @click="$refs.script4ImageInput.click()"
                                    style="background: #f0f0f0; color: #333; border: 1px solid #ddd;">
                                ğŸ“· é€‰æ‹©å›¾ç‰‡
                            </button>
                            <div v-if="autoForm.script4.images.length > 0" style="margin-top: 12px; display: flex; flex-wrap: wrap; gap: 10px;">
                                <div v-for="(image, index) in autoForm.script4.images" :key="index"
                                     style="position: relative; width: 100px; height: 100px; border-radius: 4px; overflow: hidden; border: 1px solid #ddd;">
                                    <img :src="image" style="width: 100%; height: 100%; object-fit: cover;">
                                    <button @click="removeScript4Image(index)"
                                            style="position: absolute; top: 4px; right: 4px; background: rgba(0,0,0,0.6); color: white; border: none; border-radius: 50%; width: 24px; height: 24px; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                                        Ã—
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">* è·Ÿåœˆæ¬¡æ•°</label>
                            <input type="number" class="form-input" v-model.number="autoForm.script4.followCount"
                                   placeholder="è¾“å…¥è·Ÿåœˆæ¬¡æ•° (1-10)" min="1" max="10">
                            <div style="color: #666; font-size: 12px; margin-top: 4px;">
                                ä¾‹å¦‚: è¾“å…¥3è¡¨ç¤ºæ€»å…±å‘å¸ƒ4æ¡æœ‹å‹åœˆ (ç¬¬1æ¡ç«‹å³å‘å¸ƒ + 3æ¬¡è·Ÿåœˆ)
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">* æ—¶é—´é—´éš” (åˆ†é’Ÿ)</label>
                            <input type="number" class="form-input" v-model.number="autoForm.script4.intervalMinutes"
                                   placeholder="è¾“å…¥æ—¶é—´é—´éš” (åˆ†é’Ÿ)" min="1" max="1440">
                            <div style="color: #666; font-size: 12px; margin-top: 4px;">
                                ä¾‹å¦‚: è¾“å…¥30è¡¨ç¤ºæ¯éš”30åˆ†é’Ÿå‘å¸ƒä¸€æ¬¡
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">éšæœºå»¶è¿Ÿ (Â±åˆ†é’Ÿ)</label>
                            <input type="number" class="form-input" v-model.number="autoForm.script4.randomDelayMinutes"
                                   placeholder="è¾“å…¥éšæœºå»¶è¿ŸèŒƒå›´ (å¯é€‰)" min="0" max="60">
                            <div style="color: #666; font-size: 12px; margin-top: 4px;">
                                ä¾‹å¦‚: è¾“å…¥5è¡¨ç¤ºåœ¨è®¾å®šæ—¶é—´çš„Â±5åˆ†é’Ÿå†…éšæœºå‘å¸ƒ (ç•™ç©ºæˆ–0è¡¨ç¤ºä¸ä½¿ç”¨éšæœºå»¶è¿Ÿ)
                            </div>
                        </div>

                        <div style="display: flex; gap: 12px;">
                            <button class="btn btn-primary" @click="executeScript4" :disabled="autoForm.script4Loading || !isScript4Valid">
                                <span v-if="!autoForm.script4Loading">ğŸš€ ç«‹å³å‘å¸ƒå¹¶å¯åŠ¨è·Ÿåœˆ</span>
                                <span v-else>â³ æ‰§è¡Œä¸­...</span>
                            </button>
                            <button class="btn" style="background: #ff4d4f; color: white;" @click="stopScript4" :disabled="!autoForm.script4Loading && !autoForm.script4Result">
                                <span>ğŸ›‘ åœæ­¢è·Ÿåœˆä»»åŠ¡</span>
                            </button>
                        </div>

                        <div style="margin-top: 16px; padding: 12px; background: #f5f5f5; border-radius: 4px; color: #666; font-size: 14px;">
                            <div style="font-weight: bold; margin-bottom: 8px;">ğŸ“‹ æ‰§è¡Œæµç¨‹:</div>
                            <div>1ï¸âƒ£ ç«‹å³å‘å¸ƒç¬¬1æ¡æœ‹å‹åœˆ</div>
                            <div>2ï¸âƒ£ åˆ›å»ºæ‰€æœ‰è·Ÿåœˆä»»åŠ¡ (åœ¨å †é›ªçƒä¸­è®¾ç½®å®šæ—¶å‘å¸ƒ)</div>
                            <div>3ï¸âƒ£ åˆ›å»ºåˆ é™¤ä»»åŠ¡ (åœ¨æ•°æ®åº“ä¸­è®°å½•)</div>
                            <div>4ï¸âƒ£ ç³»ç»Ÿè‡ªåŠ¨åœ¨å‘å¸ƒæ–°æœ‹å‹åœˆå‰åˆ é™¤æ—§æœ‹å‹åœˆ</div>
                            <div>5ï¸âƒ£ æœ€åä¸€æ¡æœ‹å‹åœˆä¿ç•™ä¸åˆ é™¤</div>
                        </div>

                        <!-- å®æ—¶æ—¥å¿— -->
                        <div v-if="autoForm.script4Logs.length > 0" class="card" style="margin-top: 20px; background: #f0f9ff; border: 1px solid #0052CC;">
                            <div style="font-weight: bold; color: #0052CC; margin-bottom: 12px;">
                                ğŸ“ æ‰§è¡Œæ—¥å¿—
                            </div>
                            <div style="max-height: 300px; overflow-y: auto; font-family: monospace; font-size: 13px; line-height: 1.6;">
                                <div v-for="(log, index) in autoForm.script4Logs" :key="index" style="margin-bottom: 4px;">
                                    {{ log }}
                                </div>
                            </div>
                        </div>

                        <!-- ğŸ”¥ ç§»é™¤é™æ€æ‰§è¡Œç»“æœæ˜¾ç¤º,æ”¹ç”¨å®æ—¶æ—¥å¿— -->
                    </div>
                </div>

                <!-- å…¬ä¼—å·é‡‡é›†é¡µé¢ -->
                <div class="page" :class="{active: currentPage === 'collection'}">
                    <div class="card">
                        <div class="card-title">é‡‡é›†å…¬ä¼—å·æ–‡ç« </div>
                        <div class="form-group">
                            <label class="form-label">å…¬ä¼—å·æ–‡ç« é“¾æ¥</label>
                            <input type="text" class="form-input" v-model="collectionForm.url" placeholder="è¯·è¾“å…¥å…¬ä¼—å·æ–‡ç« é“¾æ¥" :disabled="collectionLoading">
                        </div>
                        <button class="btn btn-primary" @click="startCollection" :disabled="collectionLoading">
                            <span v-if="!collectionLoading">å¼€å§‹é‡‡é›†</span>
                            <span v-else>æ­£åœ¨é‡‡é›†ä¸­...</span>
                        </button>
                    </div>

                    <div class="card" v-if="collectionResult">
                        <div class="card-title">é‡‡é›†ç»“æœ</div>
                        <div class="form-group">
                            <label class="form-label">æ–‡ç« æ ‡é¢˜</label>
                            <div style="font-weight: bold; color: #333;">{{ collectionResult.title }}</div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">ä½œè€…</label>
                            <div style="color: #666;">{{ collectionResult.author }}</div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">æ–‡ç« å†…å®¹</label>
                            <div style="max-height: 300px; overflow-y: auto; white-space: pre-wrap; line-height: 1.6; color: #333;">{{ collectionResult.content }}</div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">æ–‡ç« å›¾ç‰‡ (å…±{{ collectionResult.images.length }}å¼ )</label>
                            <div class="image-preview" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 10px; max-height: 400px; overflow-y: auto;">
                                <div v-for="(img, index) in collectionResult.images" :key="index" style="position: relative; width: 100%; height: 150px; border: 1px solid #ddd; border-radius: 4px; overflow: hidden; background: #f5f5f5;">
                                    <img :src="img" style="width: 100%; height: 100%; object-fit: cover; cursor: pointer;" @click="openImage(img)" @error="handleImageError($event)" :alt="'å›¾ç‰‡' + (index + 1)">
                                    <div style="position: absolute; bottom: 0; left: 0; right: 0; background: rgba(0,0,0,0.5); color: white; padding: 2px 5px; font-size: 12px; text-align: center;">{{ index + 1 }}</div>
                                </div>
                            </div>
                        </div>
                        <button class="btn btn-success" @click="goToRewrite">å»æ”¹å†™</button>
                    </div>
                </div>

                <!-- æ–‡æ¡ˆæ”¹å†™é¡µé¢ -->
                <div class="page" :class="{active: currentPage === 'rewrite'}">
                    <div class="card">
                        <div class="card-title">AIæ™ºèƒ½æ”¹å†™</div>
                        <div class="form-group">
                            <label class="form-label">åŸå§‹æ–‡æ¡ˆ</label>
                            <textarea class="form-input form-textarea" v-model="rewriteForm.original" placeholder="è¯·è¾“å…¥éœ€è¦æ”¹å†™çš„æ–‡æ¡ˆ"></textarea>
                        </div>

                        <!-- å›¾ç‰‡ç¼–è¾‘å™¨ -->
                        <div class="image-editor" v-if="rewriteForm.selectedImages.length > 0 || rewriteForm.images.length > 0">
                            <label class="form-label">æ–‡ç« å›¾ç‰‡ (å¯åˆ é™¤ã€æ’åºã€æ·»åŠ )</label>
                            <div class="image-gallery">
                                <!-- å·²é€‰æ‹©çš„å›¾ç‰‡ -->
                                <div v-for="(image, index) in rewriteForm.selectedImages" :key="index" class="image-item">
                                    <img :src="image" :alt="'å›¾ç‰‡' + (index + 1)">
                                    <div class="image-controls">
                                        <button class="image-btn" @click="moveImageUp(index)" :disabled="index === 0" title="ä¸Šç§»">â†‘</button>
                                        <button class="image-btn" @click="moveImageDown(index)" :disabled="index === rewriteForm.selectedImages.length - 1" title="ä¸‹ç§»">â†“</button>
                                        <button class="image-btn" @click="removeImage(index)" title="åˆ é™¤">Ã—</button>
                                    </div>
                                    <div class="image-order">{{ index + 1 }}</div>
                                </div>
                                <!-- æ·»åŠ æ–°å›¾ç‰‡æŒ‰é’® -->
                                <div class="add-image-btn" @click="showAddImageMenu" title="æ·»åŠ å›¾ç‰‡">
                                    +
                                </div>
                            </div>
                            <!-- éšè—çš„æ–‡ä»¶ä¸Šä¼ è¾“å…¥æ¡† -->
                            <input type="file" ref="imageUpload" @change="handleImageUpload" accept="image/*" style="display: none;">
                        </div>

                        <button class="btn btn-primary" @click="startRewrite" :disabled="rewriteLoading" style="margin-top: 20px;">
                            <span v-if="!rewriteLoading">å¼€å§‹æ”¹å†™</span>
                            <span v-else>æ­£åœ¨æ”¹å†™ä¸­...</span>
                        </button>
                    </div>

                    <div class="card" v-if="rewriteResult">
                        <div class="card-title">æ”¹å†™ç»“æœ</div>
                        <div class="form-group">
                            <label class="form-label">æ”¹å†™ç‰ˆæœ¬1</label>
                            <textarea v-model="rewriteResult.version1" rows="4" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;"></textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label">æ”¹å†™ç‰ˆæœ¬2</label>
                            <textarea v-model="rewriteResult.version2" rows="4" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;"></textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label">æ”¹å†™ç‰ˆæœ¬3</label>
                            <textarea v-model="rewriteResult.version3" rows="4" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;"></textarea>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn btn-success" @click="goToPublish(1)">ä½¿ç”¨ç‰ˆæœ¬1å‘å¸ƒ</button>
                            <button class="btn btn-success" @click="goToPublish(2)">ä½¿ç”¨ç‰ˆæœ¬2å‘å¸ƒ</button>
                            <button class="btn btn-success" @click="goToPublish(3)">ä½¿ç”¨ç‰ˆæœ¬3å‘å¸ƒ</button>
                        </div>
                    </div>
                </div>

                <!-- å‘å¸ƒç®¡ç†é¡µé¢ -->
                <div class="page" :class="{active: currentPage === 'publish'}">
                    <!-- åˆ›å»ºå‘å¸ƒä»»åŠ¡ -->
                    <div class="card">
                        <div class="card-title">åˆ›å»ºå‘å¸ƒä»»åŠ¡</div>

                        <div class="form-group">
                            <label class="form-label">ä»»åŠ¡æ ‡é¢˜</label>
                            <input type="text" class="form-input" v-model="publishForm.taskTitle" placeholder="è¯·è¾“å…¥ä»»åŠ¡æ ‡é¢˜(å¯é€‰)">
                        </div>

                        <div class="form-group">
                            <label class="form-label">æ–‡æ¡ˆå†…å®¹</label>
                            <textarea class="form-input form-textarea" v-model="publishForm.content" placeholder="è¯·è¾“å…¥è¦å‘å¸ƒçš„æ–‡æ¡ˆ" rows="6"></textarea>
                        </div>

                        <!-- ç±»å‹é€‰æ‹© -->
                        <div class="form-group">
                            <label class="form-label">* ç±»å‹</label>
                            <select class="form-input" v-model="publishForm.contentType">
                                <option value="text">æ–‡æœ¬</option>
                                <option value="image">å›¾ç‰‡</option>
                                <option value="video">è§†é¢‘</option>
                                <option value="link">é“¾æ¥</option>
                                <option value="video_account">è§†é¢‘å·</option>
                                <option value="video_live">è§†é¢‘å·ç›´æ’­</option>
                            </select>
                        </div>

                        <!-- ğŸ–¼ï¸ å›¾ç‰‡ç±»å‹ - å›¾ç‰‡ä¸Šä¼  -->
                        <div class="form-group" v-if="publishForm.contentType === 'image'">
                            <label class="form-label">* ä¸Šä¼ å›¾ç‰‡ (æœ€å¤š9å¼ )</label>
                            <div style="margin-bottom: 10px;">
                                <input type="file" ref="publishImageInput" accept="image/jpeg,image/jpg,image/png"
                                       multiple style="display: none;" @change="handlePublishImageUpload">
                                <button class="btn" @click="$refs.publishImageInput.click()"
                                        style="background: #1890ff; color: white; padding: 8px 16px; margin-right: 10px;">
                                    ğŸ“· ä¸Šä¼ å›¾ç‰‡
                                </button>
                                <button class="btn" style="background: #52c41a; color: white; padding: 8px 16px;">
                                    ğŸ“š ä»ç´ æåº“é€‰æ‹©
                                </button>
                                <div style="margin-top: 8px; color: #999; font-size: 12px;">
                                    æ”¯æŒjpg/pngæ ¼å¼,æ¯å¼ æœ€å¤§15MB
                                </div>
                            </div>

                            <!-- å›¾ç‰‡é¢„è§ˆ -->
                            <div v-if="publishForm.images && publishForm.images.length > 0"
                                 style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 10px;">
                                <div v-for="(img, index) in publishForm.images" :key="index"
                                     style="position: relative; width: 100px; height: 100px;">
                                    <img :src="img"
                                         style="width: 100%; height: 100%; object-fit: cover; border-radius: 4px; border: 1px solid #ddd;">
                                    <button @click="removePublishImage(index)"
                                            style="position: absolute; top: -8px; right: -8px; width: 24px; height: 24px;
                                                   border-radius: 50%; background: #ff4d4f; color: white; border: none;
                                                   cursor: pointer; font-size: 16px; line-height: 1; padding: 0;">
                                        Ã—
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- ğŸ¬ è§†é¢‘ç±»å‹ - è§†é¢‘ä¸Šä¼  -->
                        <div class="form-group" v-if="publishForm.contentType === 'video'">
                            <label class="form-label">* ä¸Šä¼ è§†é¢‘</label>
                            <div style="margin-bottom: 10px;">
                                <input type="file" ref="publishVideoInput" accept="video/mp4"
                                       style="display: none;" @change="handlePublishVideoUpload">
                                <button class="btn" @click="$refs.publishVideoInput.click()"
                                        style="background: #1890ff; color: white; padding: 8px 16px; margin-right: 10px;">
                                    ğŸ¬ ä¸Šä¼ è§†é¢‘
                                </button>
                                <button class="btn" style="background: #52c41a; color: white; padding: 8px 16px;">
                                    ğŸ“š ä»ç´ æåº“é€‰æ‹©
                                </button>
                                <div style="margin-top: 8px; color: #ff4d4f; font-size: 12px;">
                                    è¯·ä¸Šä¼ mp4æ ¼å¼è§†é¢‘,å¹¶ä¸”å¤§å°ä¸è¶…è¿‡25MB
                                </div>
                            </div>

                            <!-- è§†é¢‘é¢„è§ˆ -->
                            <div v-if="publishForm.videoUrl" style="margin-top: 10px;">
                                <video :src="publishForm.videoUrl" controls
                                       style="max-width: 300px; border-radius: 4px; border: 1px solid #ddd;"></video>
                                <button @click="removePublishVideo"
                                        style="display: block; margin-top: 10px; background: #ff4d4f; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer;">
                                    åˆ é™¤è§†é¢‘
                                </button>
                            </div>
                        </div>

                        <!-- ğŸ”— é“¾æ¥ç±»å‹ - é“¾æ¥è¾“å…¥ -->
                        <div v-if="publishForm.contentType === 'link'">
                            <!-- é“¾æ¥åœ°å€ -->
                            <div class="form-group">
                                <label class="form-label">* é“¾æ¥åœ°å€</label>
                                <div style="display: flex; gap: 10px;">
                                    <input type="url" class="form-input" v-model="publishForm.linkUrl"
                                           placeholder="è¯·è¾“å…¥é“¾æ¥åœ°å€" style="flex: 1;">
                                    <button class="btn" @click="parseLinkUrl"
                                            style="background: #1890ff; color: white; padding: 8px 16px; white-space: nowrap;">
                                        è§£æåœ°å€
                                    </button>
                                </div>
                            </div>

                            <!-- é“¾æ¥æè¿° -->
                            <div class="form-group">
                                <label class="form-label">* é“¾æ¥æè¿° (æœ€å¤š300å­—)</label>
                                <textarea class="form-input form-textarea" v-model="publishForm.linkDescription"
                                          placeholder="è¯·è¾“å…¥é“¾æ¥æè¿°" rows="3" maxlength="300"></textarea>
                                <div style="text-align: right; color: #999; font-size: 12px; margin-top: 4px;">
                                    {{ publishForm.linkDescription ? publishForm.linkDescription.length : 0 }}/300
                                </div>
                            </div>

                            <!-- é“¾æ¥å°é¢ -->
                            <div class="form-group">
                                <label class="form-label">* é“¾æ¥å°é¢</label>
                                <div style="margin-bottom: 10px;">
                                    <input type="file" ref="publishLinkCoverInput" accept="image/jpeg,image/jpg,image/png"
                                           style="display: none;" @change="handlePublishLinkCoverUpload">
                                    <button class="btn" @click="$refs.publishLinkCoverInput.click()"
                                            style="background: #1890ff; color: white; padding: 8px 16px; margin-right: 10px;">
                                        ğŸ“· ä¸Šä¼ å°é¢
                                    </button>
                                    <button class="btn" style="background: #52c41a; color: white; padding: 8px 16px;">
                                        ğŸ“š ä»ç´ æåº“é€‰æ‹©
                                    </button>
                                    <div style="margin-top: 8px; color: #999; font-size: 12px;">
                                        æ”¯æŒjpg/pngæ ¼å¼,æœ€å¤§5MB
                                    </div>
                                </div>

                                <!-- å°é¢é¢„è§ˆ -->
                                <div v-if="publishForm.linkCoverUrl" style="margin-top: 10px;">
                                    <img :src="publishForm.linkCoverUrl"
                                         style="max-width: 200px; border-radius: 4px; border: 1px solid #ddd;">
                                    <button @click="removePublishLinkCover"
                                            style="display: block; margin-top: 10px; background: #ff4d4f; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer;">
                                        åˆ é™¤å°é¢
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- ğŸ“º è§†é¢‘å·ç±»å‹ - ç´ æåº“é€‰æ‹© -->
                        <div class="form-group" v-if="publishForm.contentType === 'video_account'">
                            <label class="form-label">* é€‰æ‹©ç´ æ</label>
                            <div>
                                <button class="btn" style="background: #52c41a; color: white; padding: 8px 16px;">
                                    ğŸ“š ä»ç´ æåº“é€‰æ‹©
                                </button>
                                <div v-if="publishForm.videoAccountMaterialId" style="margin-top: 10px; padding: 10px; background: #f0f0f0; border-radius: 4px;">
                                    å·²é€‰æ‹©ç´ æID: {{ publishForm.videoAccountMaterialId }}
                                </div>
                            </div>
                        </div>

                        <!-- ğŸ“¡ è§†é¢‘å·ç›´æ’­ç±»å‹ - ç´ æåº“é€‰æ‹© -->
                        <div class="form-group" v-if="publishForm.contentType === 'video_live'">
                            <label class="form-label">* é€‰æ‹©ç´ æ</label>
                            <div>
                                <button class="btn" style="background: #52c41a; color: white; padding: 8px 16px;">
                                    ğŸ“š ä»ç´ æåº“é€‰æ‹©
                                </button>
                                <div v-if="publishForm.videoLiveMaterialId" style="margin-top: 10px; padding: 10px; background: #f0f0f0; border-radius: 4px;">
                                    å·²é€‰æ‹©ç´ æID: {{ publishForm.videoLiveMaterialId }}
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">é€‰æ‹©å¾®ä¿¡è´¦å·</label>
                            <select class="form-input" v-model="publishForm.account">
                                <option value="">è¯·é€‰æ‹©è´¦å·</option>
                                <option value="lifangde002">lifangde002 (å †é›ªçƒè´¦å·)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">å‘å¸ƒæ–¹å¼</label>
                            <div style="display: flex; gap: 20px; margin-bottom: 10px;">
                                <label style="display: flex; align-items: center; cursor: pointer;">
                                    <input type="radio" v-model="publishForm.isImmediate" :value="true" style="margin-right: 8px;">
                                    <span>ç«‹å³å‘å¸ƒ</span>
                                </label>
                                <label style="display: flex; align-items: center; cursor: pointer;">
                                    <input type="radio" v-model="publishForm.isImmediate" :value="false" style="margin-right: 8px;">
                                    <span>å®šæ—¶å‘å¸ƒ</span>
                                </label>
                            </div>
                        </div>

                        <div class="form-group" v-if="!publishForm.isImmediate">
                            <label class="form-label">å‘å¸ƒæ—¶é—´</label>
                            <input type="datetime-local" class="form-input" v-model="publishForm.publishTime">
                        </div>

                        <div class="form-group" v-if="!publishForm.isImmediate">
                            <label class="form-label">éšæœºå»¶è¿Ÿ (åˆ†é’Ÿ)</label>
                            <input type="number" class="form-input" v-model.number="publishForm.randomDelay"
                                   placeholder="0-60åˆ†é’Ÿ" min="0" max="60">
                            <p style="margin-top: 8px; color: #666; font-size: 12px;">
                                è®¾ç½®éšæœºå»¶è¿Ÿå¯ä»¥è®©å‘å¸ƒæ—¶é—´æ›´è‡ªç„¶,é¿å…è¢«æ£€æµ‹ä¸ºæœºå™¨äºº
                            </p>
                        </div>

                        <!-- å¯è§èŒƒå›´ -->
                        <div class="form-group">
                            <label class="form-label">å¯è§èŒƒå›´</label>
                            <div style="display: flex; flex-direction: column; gap: 10px;">
                                <label style="display: flex; align-items: center; cursor: pointer;">
                                    <input type="radio" v-model="publishForm.visibilityRange" value="all" style="margin-right: 8px;">
                                    <span>å…¨éƒ¨</span>
                                </label>
                                <label style="display: flex; align-items: center; cursor: pointer;">
                                    <input type="radio" v-model="publishForm.visibilityRange" value="private" style="margin-right: 8px;">
                                    <span>ç§å¯†</span>
                                </label>
                                <label style="display: flex; align-items: center; cursor: pointer;">
                                    <input type="radio" v-model="publishForm.visibilityRange" value="include_tags" style="margin-right: 8px;">
                                    <span>æŒ‡å®šæ ‡ç­¾</span>
                                </label>
                                <label style="display: flex; align-items: center; cursor: pointer;">
                                    <input type="radio" v-model="publishForm.visibilityRange" value="exclude_tags" style="margin-right: 8px;">
                                    <span>å±è”½æ ‡ç­¾åˆ—è¡¨</span>
                                </label>
                                <label style="display: flex; align-items: center; cursor: pointer;">
                                    <input type="radio" v-model="publishForm.visibilityRange" value="include_tags_dynamic" style="margin-right: 8px;">
                                    <span>æŒ‡å®šæ ‡ç­¾å˜äº†,äººä¹Ÿè·Ÿç€å˜</span>
                                </label>
                                <label style="display: flex; align-items: center; cursor: pointer;">
                                    <input type="radio" v-model="publishForm.visibilityRange" value="exclude_tags_dynamic" style="margin-right: 8px;">
                                    <span>å±è”½æ ‡ç­¾å˜äº†,äººä¹Ÿè·Ÿç€å˜</span>
                                </label>
                            </div>
                            <p style="margin-top: 8px; color: #999; font-size: 12px;">
                                å¯è§èŒƒå›´ä»…æ”¯æŒå¾®6.6.6åŠä»¥ä¸Šç‰ˆæœ¬
                            </p>
                        </div>

                        <!-- è¿½è¯„è®º -->
                        <div class="form-group">
                            <label class="form-label">è¿½è¯„è®º (ç¬¬{{ publishForm.comments.length }}æ¡)</label>
                            <div style="margin-bottom: 10px;">
                                <button class="btn" @click="addComment" style="background: #f0f0f0; color: #666; padding: 6px 12px; font-size: 14px;">
                                    + æ–°å¢è¿½è¯„
                                </button>
                            </div>
                            <div v-for="(comment, index) in publishForm.comments" :key="index"
                                 style="margin-bottom: 10px; display: flex; gap: 10px; align-items: flex-start;">
                                <textarea class="form-input form-textarea" v-model="publishForm.comments[index]"
                                          :placeholder="'ç¬¬' + (index + 1) + 'æ¡è¿½è¯„è®º'" rows="2"
                                          style="flex: 1;"></textarea>
                                <button @click="removeComment(index)"
                                        style="padding: 6px 12px; background: #ff4d4f; color: white; border: none;
                                               border-radius: 4px; cursor: pointer; font-size: 14px;">
                                    åˆ é™¤
                                </button>
                            </div>
                        </div>

                        <!-- æ˜¾ç¤ºå®šä½ -->
                        <div class="form-group">
                            <label class="form-label">æ˜¾ç¤ºå®šä½</label>
                            <label style="display: flex; align-items: center; cursor: pointer;">
                                <input type="checkbox" v-model="publishForm.useLocation" style="margin-right: 8px;">
                                <span>ä½¿ç”¨å®šä½</span>
                            </label>
                        </div>

                        <!-- éšæœºè¡¥å……å†…å®¹ -->
                        <div class="form-group">
                            <label class="form-label">éšæœºè¡¥å……å†…å®¹</label>
                            <textarea class="form-input form-textarea" v-model="publishForm.randomContent"
                                      placeholder="ä¼šåœ¨æœ‹å‹åœˆæ–‡æ¡ˆæœ€åæ’å…¥å¡«å†™çš„å†…å®¹,å¤šä¸ªå†…å®¹ç”¨;éš”å¼€" rows="3"></textarea>
                        </div>

                        <!-- ä»»åŠ¡ç»“æŸæ—¶é—´ -->
                        <div class="form-group" v-if="!publishForm.isImmediate">
                            <label class="form-label">ä»»åŠ¡ç»“æŸæ—¶é—´</label>
                            <input type="datetime-local" class="form-input" v-model="publishForm.endTime">
                            <p style="margin-top: 8px; color: #666; font-size: 12px;">
                                å¦‚æœä»»åŠ¡æ‰§è¡Œè¶…è¿‡è¿™ä¸ªæ—¶é—´,åˆ™ä¸ç®¡æœ‰æ²¡æœ‰å‘é€æˆåŠŸæœ‹å‹åœˆ,éƒ½ä¼šåœæ­¢ä»»åŠ¡
                            </p>
                        </div>

                        <div style="display: flex; gap: 10px;">
                            <button class="btn btn-primary" @click="createPublishTask" :disabled="publishTaskCreating">
                                {{ publishTaskCreating ? 'åˆ›å»ºä¸­...' : 'åˆ›å»ºä»»åŠ¡' }}
                            </button>
                            <button class="btn" @click="resetPublishForm" style="background: #f0f0f0; color: #666;">
                                é‡ç½®è¡¨å•
                            </button>
                            <button class="btn" @click="previewPublish" style="background: #52c41a; color: white;">
                                é¢„è§ˆ
                            </button>
                        </div>
                    </div>

                    <!-- ä»»åŠ¡åˆ—è¡¨ -->
                    <div class="card">
                        <div class="card-title" style="display: flex; justify-content: space-between; align-items: center;">
                            <span>å‘å¸ƒä»»åŠ¡åˆ—è¡¨</span>
                            <button class="btn btn-primary" @click="loadPublishTasks" style="padding: 6px 12px; font-size: 14px;">
                                åˆ·æ–°åˆ—è¡¨
                            </button>
                        </div>

                        <div v-if="publishTasksLoading" style="text-align: center; padding: 40px; color: #666;">
                            åŠ è½½ä¸­...
                        </div>

                        <div v-else-if="publishTasks.length === 0" style="text-align: center; padding: 40px; color: #999;">
                            æš‚æ— å‘å¸ƒä»»åŠ¡
                        </div>

                        <table class="table" v-else>
                            <thead>
                                <tr>
                                    <th>ä»»åŠ¡æ ‡é¢˜</th>
                                    <th>æ–‡æ¡ˆå†…å®¹</th>
                                    <th>å›¾ç‰‡</th>
                                    <th>å¾®ä¿¡è´¦å·</th>
                                    <th>å‘å¸ƒæ—¶é—´</th>
                                    <th>çŠ¶æ€</th>
                                    <th>åˆ›å»ºæ—¶é—´</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="task in publishTasks" :key="task.id">
                                    <td>{{ task.task_title || 'æ— æ ‡é¢˜' }}</td>
                                    <td style="max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                                        {{ task.content }}
                                    </td>
                                    <td>
                                        <span v-if="task.images && task.images.length > 0">
                                            {{ task.images.length }}å¼ 
                                        </span>
                                        <span v-else style="color: #999;">æ— å›¾ç‰‡</span>
                                    </td>
                                    <td>{{ task.wechat_account || '-' }}</td>
                                    <td>
                                        <span v-if="task.is_immediate" style="color: #52c41a;">ç«‹å³å‘å¸ƒ</span>
                                        <span v-else>{{ formatDateTime(task.publish_time) }}</span>
                                    </td>
                                    <td>
                                        <span class="tag" :class="{
                                            'tag-warning': task.status === 'pending',
                                            'tag-info': task.status === 'processing',
                                            'tag-success': task.status === 'completed',
                                            'tag-danger': task.status === 'failed'
                                        }">
                                            {{ getStatusText(task.status) }}
                                        </span>
                                    </td>
                                    <td>{{ formatDateTime(task.created_at) }}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- å †é›ªçƒè´¦å·è®¾ç½®é¡µé¢ -->
                <div class="page" :class="{active: currentPage === 'accounts'}">
                    <div class="card">
                        <div class="card-title" style="display: flex; justify-content: space-between; align-items: center;">
                            <span>å †é›ªçƒè´¦å·ç®¡ç†</span>
                            <button v-if="duixueqiuAccounts.length === 0" class="btn btn-primary" @click="showAddDuixueqiuAccountForm">
                                â• æ·»åŠ è´¦å·
                            </button>
                            <span v-else style="color: #999; font-size: 14px;">æ¯ä¸ªç”¨æˆ·åªèƒ½é…ç½®ä¸€ä¸ªå †é›ªçƒè´¦å·</span>
                        </div>

                        <div v-if="duixueqiuAccountsLoading" style="text-align: center; padding: 40px;">
                            <div class="loading-spinner"></div>
                            <p style="margin-top: 16px; color: #666;">åŠ è½½ä¸­...</p>
                        </div>

                        <div v-else-if="duixueqiuAccounts.length === 0" style="text-align: center; padding: 40px; color: #999;">
                            <p>æš‚æ— å †é›ªçƒè´¦å·,è¯·ç‚¹å‡»ä¸Šæ–¹"â• æ·»åŠ è´¦å·"æŒ‰é’®æ·»åŠ </p>
                            <p style="font-size: 12px; margin-top: 10px;">æç¤º:æ¯ä¸ªç”¨æˆ·åªèƒ½é…ç½®ä¸€ä¸ªå †é›ªçƒè´¦å·</p>
                        </div>

                        <table v-else class="table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>å †é›ªçƒç”¨æˆ·å</th>
                                    <th>åˆ›å»ºæ—¶é—´</th>
                                    <th>æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="account in duixueqiuAccounts" :key="account.id">
                                    <td>{{ account.id }}</td>
                                    <td>{{ account.username }}</td>
                                    <td>{{ formatDate(account.created_at) }}</td>
                                    <td>
                                        <button class="btn btn-sm btn-primary" @click="showEditDuixueqiuAccountForm(account)">ç¼–è¾‘</button>
                                        <button class="btn btn-sm btn-danger" @click="deleteDuixueqiuAccount(account.id)">åˆ é™¤</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- æ·»åŠ /ç¼–è¾‘è´¦å·å¯¹è¯æ¡† -->
                    <div v-if="duixueqiuAccountFormVisible" class="modal-overlay" @click.self="duixueqiuAccountFormVisible = false">
                        <div class="modal-content" style="max-width: 500px;">
                            <div class="modal-header">
                                <h3>{{ duixueqiuAccountForm.id ? 'ç¼–è¾‘è´¦å·' : 'æ·»åŠ è´¦å·' }}</h3>
                                <button class="modal-close" @click="duixueqiuAccountFormVisible = false">Ã—</button>
                            </div>
                            <div class="modal-body">
                                <div class="form-group">
                                    <label class="form-label">å †é›ªçƒç”¨æˆ·å</label>
                                    <input type="text" class="form-input" v-model="duixueqiuAccountForm.username" placeholder="è¯·è¾“å…¥å †é›ªçƒç”¨æˆ·å" autocomplete="off">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">å †é›ªçƒå¯†ç </label>
                                    <input type="password" class="form-input" v-model="duixueqiuAccountForm.password" placeholder="è¯·è¾“å…¥å †é›ªçƒå¯†ç " autocomplete="new-password">
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button class="btn btn-secondary" @click="duixueqiuAccountFormVisible = false" :disabled="duixueqiuAccountFormLoading">å–æ¶ˆ</button>
                                <button class="btn btn-primary" @click="saveDuixueqiuAccount" :disabled="duixueqiuAccountFormLoading">
                                    {{ duixueqiuAccountFormLoading ? 'ä¿å­˜ä¸­...' : 'ä¿å­˜' }}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Cozeé…ç½®é¡µé¢ -->
                <div class="page" :class="{active: currentPage === 'coze-config'}">
                    <div class="card">
                        <div class="card-title">Coze APIé…ç½®</div>
                        <div class="form-group">
                            <label class="form-label">Coze API Token</label>
                            <input type="text" class="form-input" placeholder="è¯·è¾“å…¥Coze API Token" v-model="cozeConfig.token">
                        </div>
                        <div class="form-group">
                            <label class="form-label">é‡‡é›†å·¥ä½œæµID</label>
                            <input type="text" class="form-input" placeholder="è¯·è¾“å…¥å…¬ä¼—å·é‡‡é›†å·¥ä½œæµID" v-model="cozeConfig.collectionWorkflowId">
                        </div>
                        <div class="form-group">
                            <label class="form-label">è½¬å†™å·¥ä½œæµID</label>
                            <input type="text" class="form-input" placeholder="è¯·è¾“å…¥æ–‡æ¡ˆè½¬å†™å·¥ä½œæµID" v-model="cozeConfig.rewriteWorkflowId">
                        </div>
                        <button class="btn btn-primary" @click="saveCozeConfig">ä¿å­˜é…ç½®</button>
                    </div>
                </div>

                <!-- é£ä¹¦å¤šç»´è¡¨æ ¼é…ç½®é¡µé¢ -->
                <div class="page" :class="{active: currentPage === 'feishu-config'}">
                    <div class="card">
                        <div class="card-title">é£ä¹¦å¤šç»´è¡¨æ ¼é…ç½®</div>
                        <div class="form-group">
                            <label class="form-label">é£ä¹¦åº”ç”¨ID (App ID)</label>
                            <input type="text" class="form-input" placeholder="è¯·è¾“å…¥é£ä¹¦åº”ç”¨ID" v-model="feishuConfig.appId">
                        </div>
                        <div class="form-group">
                            <label class="form-label">é£ä¹¦åº”ç”¨å¯†é’¥ (App Secret)</label>
                            <input type="password" class="form-input" placeholder="è¯·è¾“å…¥é£ä¹¦åº”ç”¨å¯†é’¥" v-model="feishuConfig.appSecret">
                        </div>
                        <div class="form-group">
                            <label class="form-label">å¤šç»´è¡¨æ ¼ID</label>
                            <input type="text" class="form-input" placeholder="è¯·è¾“å…¥å¤šç»´è¡¨æ ¼ID" v-model="feishuConfig.tableId">
                        </div>
                        <button class="btn btn-primary" @click="saveFeishuConfig">ä¿å­˜é…ç½®</button>
                    </div>
                </div>

                <!-- å…¬ä¼—å·ç›‘æ§é¡µé¢ - iframeåµŒå…¥ -->
                <div class="page" :class="{active: currentPage === 'wechat-monitor'}">
                    <div class="iframe-container">
                        <iframe src="wechat-subscription.html" frameborder="0"></iframe>
                    </div>
                </div>

                <!-- ç³»ç»Ÿè®¾ç½®é¡µé¢ -->
                <div class="page" :class="{active: currentPage === 'settings'}">
                    <div class="card">
                        <div class="card-title">ç³»ç»Ÿé…ç½®</div>
                        <div class="form-group">
                            <label class="form-label">Coze APIå¯†é’¥</label>
                            <input type="text" class="form-input" placeholder="è¯·è¾“å…¥Coze APIå¯†é’¥">
                        </div>
                        <div class="form-group">
                            <label class="form-label">é£ä¹¦åº”ç”¨ID</label>
                            <input type="text" class="form-input" placeholder="è¯·è¾“å…¥é£ä¹¦åº”ç”¨ID">
                        </div>
                        <div class="form-group">
                            <label class="form-label">å †é›ªçƒè´¦å·</label>
                            <input type="text" class="form-input" placeholder="è¯·è¾“å…¥å †é›ªçƒè´¦å·">
                        </div>
                        <button class="btn btn-primary">ä¿å­˜è®¾ç½®</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    currentPage: 'auto-workflow',
                    userName: 'åˆ€ä»”è€æ¿',
                    userAvatar: 'åˆ€',
                    userId: null,  // ç”¨æˆ·ID
                    mobileMenuOpen: false,  // ç§»åŠ¨ç«¯èœå•çŠ¶æ€
                    menuGroups: {
                        auto: false,
                        manual: false,
                        api: false
                    },
                    collectionForm: {
                        url: ''
                    },
                    collectionLoading: false,
                    collectionResult: null,
                    rewriteForm: {
                        articleId: null,
                        original: '',
                        images: [],  // åŸå§‹å›¾ç‰‡åˆ—è¡¨
                        selectedImages: []  // ç”¨æˆ·é€‰æ‹©çš„å›¾ç‰‡åˆ—è¡¨
                    },
                    rewriteLoading: false,
                    rewriteResult: null,
                    publishForm: {
                        taskTitle: '',
                        content: '',
                        contentType: 'text',  // ç±»å‹: text/image/video/link/video_account/video_live
                        images: [],
                        account: '',
                        isImmediate: true,
                        publishTime: '',
                        randomDelay: 0,
                        // æ–°å¢åŠŸèƒ½å­—æ®µ
                        visibilityRange: 'all',  // å¯è§èŒƒå›´: all/private/include_tags/exclude_tags/include_tags_dynamic/exclude_tags_dynamic
                        selectedTags: [],  // é€‰æ‹©çš„æ ‡ç­¾
                        comments: [],  // è¿½è¯„è®ºåˆ—è¡¨
                        useLocation: false,  // æ˜¯å¦ä½¿ç”¨å®šä½
                        randomContent: '',  // éšæœºè¡¥å……å†…å®¹(ç”¨;åˆ†éš”)
                        endTime: '',  // ä»»åŠ¡ç»“æŸæ—¶é—´
                        // è§†é¢‘ç±»å‹å­—æ®µ
                        videoUrl: '',  // è§†é¢‘URL
                        // é“¾æ¥ç±»å‹å­—æ®µ
                        linkUrl: '',  // é“¾æ¥åœ°å€
                        linkDescription: '',  // é“¾æ¥æè¿°
                        linkCoverUrl: '',  // é“¾æ¥å°é¢URL
                        // è§†é¢‘å·ç±»å‹å­—æ®µ
                        videoAccountMaterialId: '',  // è§†é¢‘å·ç´ æID
                        // è§†é¢‘å·ç›´æ’­ç±»å‹å­—æ®µ
                        videoLiveMaterialId: ''  // è§†é¢‘å·ç›´æ’­ç´ æID
                    },
                    publishTasks: [],
                    publishTasksLoading: false,
                    publishTaskCreating: false,
                    socket: null, // WebSocketè¿æ¥
                    autoForm: {
                        selectedScript: 'script1', // å½“å‰é€‰æ‹©çš„è„šæœ¬
                        script1Loading: false, // è„šæœ¬1æ‰§è¡ŒçŠ¶æ€
                        script3Loading: false, // è„šæœ¬3æ‰§è¡ŒçŠ¶æ€
                        script4Loading: false, // è„šæœ¬4æ‰§è¡ŒçŠ¶æ€
                        script1Result: null, // è„šæœ¬1æ‰§è¡Œç»“æœ
                        script3Result: null, // è„šæœ¬3æ‰§è¡Œç»“æœ
                        script4Result: null, // è„šæœ¬4æ‰§è¡Œç»“æœ
                        script1Logs: [], // è„šæœ¬1æµå¼æ—¥å¿—
                        script3Logs: [], // è„šæœ¬3æµå¼æ—¥å¿—
                        script4Logs: [], // è„šæœ¬4æµå¼æ—¥å¿—
                        // è„šæœ¬1: è¾“å…¥é“¾æ¥è‡ªåŠ¨å‘å¸ƒ
                        script1: {
                            url: '',
                            isImmediate: true,
                            publishTime: '',
                            contentType: 'image',
                            selectedAccounts: [],
                            selectedTags: [],
                            useLocation: false,
                            comments: '',
                            randomContent: ''
                        },
                        // è„šæœ¬3: å®šæ—¶ç›‘æ§è‡ªåŠ¨å‘å¸ƒ
                        script3: {
                            accountIds: [],
                            autoRewrite: true,
                            autoPublish: true,
                            publishDelay: 0,
                            contentType: 'image',
                            selectedAccounts: [],
                            selectedTags: [],
                            useLocation: false,
                            comments: '',
                            randomContent: ''
                        },
                        // è„šæœ¬4: è·Ÿåœˆè‡ªåŠ¨åŒ–
                        script4: {
                            content: '',
                            images: [],
                            contentType: 'text', // å†…å®¹ç±»å‹: text/image
                            followCount: 3,
                            intervalMinutes: 30, // é»˜è®¤30åˆ†é’Ÿ
                            randomDelayMinutes: 0 // é»˜è®¤ä¸ä½¿ç”¨éšæœºå»¶è¿Ÿ
                        }
                    },
                    cozeConfig: {
                        token: '',
                        collectionWorkflowId: '',
                        rewriteWorkflowId: ''
                    },
                    feishuConfig: {
                        appId: '',
                        appSecret: '',
                        tableId: ''
                    },
                    // å †é›ªçƒè´¦å·ç®¡ç†
                    duixueqiuAccounts: [],
                    duixueqiuAccountsLoading: false,
                    duixueqiuAccountForm: {
                        id: null,
                        username: '',
                        password: ''
                    },
                    duixueqiuAccountFormVisible: false,
                    duixueqiuAccountFormLoading: false,
                    // å…¬ä¼—å·ç›‘æ§ç›¸å…³æ•°æ®
                    wechatMonitor: {
                        activeTab: 'articles',
                        loading: false,
                        subscriptions: [],
                        articles: [],
                        selectedMp: null,
                        totalArticles: 0,
                        allArticlesCount: 0,
                        qrCodeUrl: '',
                        qrStatus: 'ç‚¹å‡»æŒ‰é’®è·å–äºŒç»´ç ',
                        qrCheckInterval: null,
                        searchKeyword: '',
                        searchResults: [],
                        selectedMpData: null,
                        newSubscription: {
                            name: '',
                            mp_id: '',
                            description: ''
                        },
                        syncInterval: 30,
                        showArticleModal: false,
                        currentArticle: null
                    },
                    // è‡ªåŠ¨æ£€æµ‹ç¯å¢ƒ: æœ¬åœ°å¼€å‘ä½¿ç”¨localhost:3000, ç”Ÿäº§ç¯å¢ƒä½¿ç”¨autochat.lfdhk.com
                    apiBaseUrl: window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
                        ? 'http://localhost:3000/api'
                        : 'https://autochat.lfdhk.com/api',
                    rssApiUrl: 'http://localhost:8001/api/v1/wx'
                }
            },
            computed: {
                pageTitle() {
                    const titles = {
                        dashboard: 'ä»ªè¡¨ç›˜',
                        'auto-workflow': 'è‡ªåŠ¨æ¨¡å¼ - ä¸€é”®å‘å¸ƒ',
                        'wechat-monitor': 'å…¬ä¼—å·ç›‘æ§',
                        collection: 'æ‰‹åŠ¨æ¨¡å¼ - å…¬ä¼—å·æå–',
                        rewrite: 'æ‰‹åŠ¨æ¨¡å¼ - æ–‡æ¡ˆè½¬å†™',
                        publish: 'æ‰‹åŠ¨æ¨¡å¼ - è‡ªåŠ¨å‘å¸ƒ',
                        accounts: 'å †é›ªçƒè´¦å·è®¾ç½®',
                        'coze-config': 'APIé…ç½® - Coze',
                        'feishu-config': 'APIé…ç½® - é£ä¹¦å¤šç»´è¡¨æ ¼',
                        settings: 'ç³»ç»Ÿè®¾ç½®'
                    };
                    return titles[this.currentPage] || 'æœ‹å‹åœˆå‘å¸ƒç³»ç»Ÿ';
                },
                // è„šæœ¬4è¡¨å•éªŒè¯
                isScript4Valid() {
                    return this.autoForm.script4.content.trim() !== '' &&
                           this.autoForm.script4.followCount >= 1 &&
                           this.autoForm.script4.followCount <= 10 &&
                           this.autoForm.script4.intervalMinutes >= 1 &&
                           this.autoForm.script4.intervalMinutes <= 1440; // æœ€å¤š24å°æ—¶
                }
            },
            methods: {
                // ç§»åŠ¨ç«¯èœå•æ§åˆ¶
                toggleMobileMenu() {
                    this.mobileMenuOpen = !this.mobileMenuOpen;
                },
                closeMobileMenu() {
                    this.mobileMenuOpen = false;
                },
                toggleMenuGroup(groupName) {
                    this.menuGroups[groupName] = !this.menuGroups[groupName];
                    // ç§»åŠ¨ç«¯ç‚¹å‡»èœå•é¡¹åè‡ªåŠ¨å…³é—­èœå•
                    if (window.innerWidth <= 768) {
                        setTimeout(() => {
                            this.closeMobileMenu();
                        }, 300);
                    }
                },
                async startCollection() {
                    if (!this.collectionForm.url) {
                        alert('è¯·è¾“å…¥å…¬ä¼—å·æ–‡ç« é“¾æ¥');
                        return;
                    }

                    // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                    this.collectionLoading = true;
                    this.collectionResult = null;

                    try {
                        console.log('æ­£åœ¨é‡‡é›†æ–‡ç« ...');

                        // è°ƒç”¨åç«¯API
                        const response = await fetch('https://autochat.lfdhk.com/api/collection/extract', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                url: this.collectionForm.url
                            })
                        });

                        if (!response.ok) {
                            throw new Error(`APIè¯·æ±‚å¤±è´¥: ${response.status}`);
                        }

                        const data = await response.json();
                        console.log('åç«¯APIå“åº”:', data);

                        if (!data.success) {
                            throw new Error(data.message || 'é‡‡é›†å¤±è´¥');
                        }

                        this.collectionResult = {
                            title: data.data.title,
                            author: data.data.author,
                            content: data.data.content,
                            images: data.data.images // è¿™é‡Œæ˜¯Supabaseçš„å›¾ç‰‡URL
                        };

                        console.log('âœ… é‡‡é›†æˆåŠŸ!');

                    } catch (error) {
                        console.error('é‡‡é›†å¤±è´¥:', error);
                        alert('é‡‡é›†å¤±è´¥: ' + error.message);
                    } finally {
                        // å…³é—­åŠ è½½çŠ¶æ€
                        this.collectionLoading = false;
                    }
                },
                goToRewrite() {
                    this.currentPage = 'rewrite';
                    this.rewriteForm.original = this.collectionResult.content;
                    this.rewriteForm.images = this.collectionResult.images || [];
                    this.rewriteForm.selectedImages = [...(this.collectionResult.images || [])];  // é»˜è®¤é€‰ä¸­æ‰€æœ‰å›¾ç‰‡
                },
                async startRewrite() {
                    if (!this.rewriteForm.original) {
                        alert('è¯·å…ˆè¾“å…¥éœ€è¦æ”¹å†™çš„æ–‡æ¡ˆ');
                        return;
                    }

                    this.rewriteLoading = true;

                    try {
                        // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                        this.rewriteResult = {
                            version1: 'æ­£åœ¨è°ƒç”¨Coze AIç”Ÿæˆç‰ˆæœ¬1...',
                            version2: 'æ­£åœ¨è°ƒç”¨Coze AIç”Ÿæˆç‰ˆæœ¬2...',
                            version3: 'æ­£åœ¨è°ƒç”¨Coze AIç”Ÿæˆç‰ˆæœ¬3...'
                        };

                        const response = await fetch(`${this.apiBaseUrl}/coze/rewrite`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${localStorage.getItem('token')}`
                            },
                            body: JSON.stringify({
                                content: this.rewriteForm.original,
                                images: this.rewriteForm.selectedImages,
                                articleId: this.rewriteForm.articleId
                            })
                        });

                        const data = await response.json();

                        if (data.success) {
                            this.rewriteResult = {
                                version1: data.data.version1,
                                version2: data.data.version2,
                                version3: data.data.version3
                            };
                            console.log('âœ… è½¬å†™æˆåŠŸ!å·²ç”Ÿæˆ3ä¸ªç‰ˆæœ¬çš„æ–‡æ¡ˆ');
                        } else {
                            alert('è½¬å†™å¤±è´¥: ' + (data.message || 'æœªçŸ¥é”™è¯¯'));
                            this.rewriteResult = {
                                version1: '',
                                version2: '',
                                version3: ''
                            };
                        }
                    } catch (error) {
                        console.error('è½¬å†™å¤±è´¥:', error);
                        alert('è½¬å†™å¤±è´¥: ' + error.message);
                        this.rewriteResult = {
                            version1: '',
                            version2: '',
                            version3: ''
                        };
                    } finally {
                        this.rewriteLoading = false;
                    }
                },
                goToPublish(version = 1) {
                    this.currentPage = 'publish';
                    // æ ¹æ®é€‰æ‹©çš„ç‰ˆæœ¬è®¾ç½®å‘å¸ƒå†…å®¹
                    if (version === 1) {
                        this.publishForm.content = this.rewriteResult.version1;
                    } else if (version === 2) {
                        this.publishForm.content = this.rewriteResult.version2;
                    } else if (version === 3) {
                        this.publishForm.content = this.rewriteResult.version3;
                    }
                    // åŒæ—¶è®¾ç½®å›¾ç‰‡
                    this.publishForm.images = this.rewriteForm.selectedImages || [];
                },
                async createPublishTask() {
                    // éªŒè¯è¡¨å•
                    if (!this.publishForm.content.trim()) {
                        alert('è¯·è¾“å…¥æ–‡æ¡ˆå†…å®¹');
                        return;
                    }
                    if (!this.publishForm.account) {
                        alert('è¯·é€‰æ‹©å¾®ä¿¡è´¦å·');
                        return;
                    }
                    if (!this.publishForm.isImmediate && !this.publishForm.publishTime) {
                        alert('è¯·é€‰æ‹©å‘å¸ƒæ—¶é—´');
                        return;
                    }

                    this.publishTaskCreating = true;

                    try {
                        const token = localStorage.getItem('token');
                        const user = JSON.parse(localStorage.getItem('user') || '{}');

                        // å‡†å¤‡å‘å¸ƒæ—¶é—´
                        let publishTime;
                        if (this.publishForm.isImmediate) {
                            publishTime = new Date().toISOString();
                        } else {
                            publishTime = new Date(this.publishForm.publishTime).toISOString();
                        }

                        const response = await fetch('https://autochat.lfdhk.com/api/publish/create', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${token}`
                            },
                            body: JSON.stringify({
                                userId: user.id,
                                taskTitle: this.publishForm.taskTitle || 'æœ‹å‹åœˆå‘å¸ƒä»»åŠ¡',
                                content: this.publishForm.content,
                                contentType: this.publishForm.contentType,  // ç±»å‹
                                images: this.publishForm.images,
                                wechatAccount: this.publishForm.account,
                                publishTime: publishTime,
                                isImmediate: this.publishForm.isImmediate,
                                randomDelayMinutes: this.publishForm.randomDelay || 0,
                                // æ–°å¢å­—æ®µ
                                visibilityRange: this.publishForm.visibilityRange,
                                selectedTags: this.publishForm.selectedTags,
                                comments: this.publishForm.comments.filter(c => c.trim()),
                                useLocation: this.publishForm.useLocation,
                                randomContent: this.publishForm.randomContent,
                                endTime: this.publishForm.endTime ? new Date(this.publishForm.endTime).toISOString() : null
                            })
                        });

                        const result = await response.json();

                        if (response.ok) {
                            console.log('âœ… å‘å¸ƒä»»åŠ¡åˆ›å»ºæˆåŠŸï¼');
                            // é‡ç½®è¡¨å•
                            this.resetPublishForm();
                            // åˆ·æ–°ä»»åŠ¡åˆ—è¡¨
                            await this.loadPublishTasks();
                        } else {
                            alert('åˆ›å»ºå¤±è´¥: ' + (result.message || 'æœªçŸ¥é”™è¯¯'));
                        }
                    } catch (error) {
                        console.error('åˆ›å»ºå‘å¸ƒä»»åŠ¡å¤±è´¥:', error);
                        alert('åˆ›å»ºå¤±è´¥: ' + error.message);
                    } finally {
                        this.publishTaskCreating = false;
                    }
                },
                resetPublishForm() {
                    this.publishForm = {
                        taskTitle: '',
                        content: '',
                        contentType: 'text',
                        images: [],
                        account: '',
                        isImmediate: true,
                        publishTime: '',
                        randomDelay: 0,
                        visibilityRange: 'all',
                        selectedTags: [],
                        comments: [],
                        useLocation: false,
                        randomContent: '',
                        endTime: '',
                        // è§†é¢‘ç±»å‹å­—æ®µ
                        videoUrl: '',
                        // é“¾æ¥ç±»å‹å­—æ®µ
                        linkUrl: '',
                        linkDescription: '',
                        linkCoverUrl: '',
                        // è§†é¢‘å·ç±»å‹å­—æ®µ
                        videoAccountMaterialId: '',
                        // è§†é¢‘å·ç›´æ’­ç±»å‹å­—æ®µ
                        videoLiveMaterialId: ''
                    };
                    // æ¸…ç©ºæ–‡ä»¶è¾“å…¥æ¡†
                    if (this.$refs.publishImageInput) {
                        this.$refs.publishImageInput.value = '';
                    }
                    if (this.$refs.publishVideoInput) {
                        this.$refs.publishVideoInput.value = '';
                    }
                    if (this.$refs.publishLinkCoverInput) {
                        this.$refs.publishLinkCoverInput.value = '';
                    }
                },
                addComment() {
                    this.publishForm.comments.push('');
                },
                removeComment(index) {
                    this.publishForm.comments.splice(index, 1);
                },
                previewPublish() {
                    // é¢„è§ˆæœ‹å‹åœˆæ•ˆæœ
                    let previewText = '=== æœ‹å‹åœˆé¢„è§ˆ ===\n\n';
                    previewText += `ğŸ“ æ–‡æ¡ˆå†…å®¹:\n${this.publishForm.content}\n\n`;

                    if (this.publishForm.images.length > 0) {
                        previewText += `ğŸ–¼ï¸ å›¾ç‰‡: ${this.publishForm.images.length}å¼ \n\n`;
                    }

                    if (this.publishForm.comments.length > 0) {
                        previewText += `ğŸ’¬ è¿½è¯„è®º:\n`;
                        this.publishForm.comments.forEach((comment, index) => {
                            if (comment.trim()) {
                                previewText += `  ${index + 1}. ${comment}\n`;
                            }
                        });
                        previewText += '\n';
                    }

                    if (this.publishForm.randomContent) {
                        const randomContents = this.publishForm.randomContent.split(';').filter(c => c.trim());
                        if (randomContents.length > 0) {
                            previewText += `ğŸ² éšæœºè¡¥å……å†…å®¹(å°†éšæœºé€‰æ‹©ä¸€ä¸ª):\n`;
                            randomContents.forEach((content, index) => {
                                previewText += `  ${index + 1}. ${content.trim()}\n`;
                            });
                            previewText += '\n';
                        }
                    }

                    previewText += `ğŸ‘ï¸ å¯è§èŒƒå›´: `;
                    const visibilityMap = {
                        'all': 'å…¨éƒ¨',
                        'private': 'ç§å¯†',
                        'include_tags': 'æŒ‡å®šæ ‡ç­¾',
                        'exclude_tags': 'å±è”½æ ‡ç­¾åˆ—è¡¨',
                        'include_tags_dynamic': 'æŒ‡å®šæ ‡ç­¾å˜äº†,äººä¹Ÿè·Ÿç€å˜',
                        'exclude_tags_dynamic': 'å±è”½æ ‡ç­¾å˜äº†,äººä¹Ÿè·Ÿç€å˜'
                    };
                    previewText += visibilityMap[this.publishForm.visibilityRange] || 'å…¨éƒ¨';
                    previewText += '\n\n';

                    if (this.publishForm.useLocation) {
                        previewText += `ğŸ“ æ˜¾ç¤ºå®šä½: æ˜¯\n\n`;
                    }

                    previewText += `â° å‘å¸ƒæ–¹å¼: ${this.publishForm.isImmediate ? 'ç«‹å³å‘å¸ƒ' : 'å®šæ—¶å‘å¸ƒ'}\n`;
                    if (!this.publishForm.isImmediate) {
                        previewText += `â° å‘å¸ƒæ—¶é—´: ${this.publishForm.publishTime}\n`;
                        if (this.publishForm.randomDelay > 0) {
                            previewText += `ğŸ² éšæœºå»¶è¿Ÿ: ${this.publishForm.randomDelay}åˆ†é’Ÿ\n`;
                        }
                        if (this.publishForm.endTime) {
                            previewText += `â±ï¸ ä»»åŠ¡ç»“æŸæ—¶é—´: ${this.publishForm.endTime}\n`;
                        }
                    }

                    alert(previewText);
                },
                handlePublishImageUpload(event) {
                    const files = event.target.files;
                    if (!files || files.length === 0) return;

                    // æ£€æŸ¥å›¾ç‰‡æ•°é‡é™åˆ¶
                    const currentCount = this.publishForm.images.length;
                    const newCount = files.length;
                    if (currentCount + newCount > 9) {
                        alert(`æœ€å¤šåªèƒ½ä¸Šä¼ 9å¼ å›¾ç‰‡,å½“å‰å·²æœ‰${currentCount}å¼ ,åªèƒ½å†æ·»åŠ ${9 - currentCount}å¼ `);
                        return;
                    }

                    // è¯»å–å¹¶è½¬æ¢å›¾ç‰‡ä¸ºBase64
                    Array.from(files).forEach(file => {
                        // æ£€æŸ¥æ–‡ä»¶ç±»å‹
                        if (!file.type.match(/image\/(jpeg|jpg|png)/)) {
                            alert(`æ–‡ä»¶ ${file.name} æ ¼å¼ä¸æ”¯æŒ,åªæ”¯æŒjpgã€pngæ ¼å¼`);
                            return;
                        }

                        // æ£€æŸ¥æ–‡ä»¶å¤§å°(15MB)
                        if (file.size > 15 * 1024 * 1024) {
                            alert(`æ–‡ä»¶ ${file.name} å¤ªå¤§,æœ€å¤§æ”¯æŒ15MB`);
                            return;
                        }

                        const reader = new FileReader();
                        reader.onload = (e) => {
                            this.publishForm.images.push(e.target.result);
                        };
                        reader.readAsDataURL(file);
                    });
                },
                removePublishImage(index) {
                    this.publishForm.images.splice(index, 1);
                },
                // å¤„ç†è§†é¢‘ä¸Šä¼ 
                handlePublishVideoUpload(event) {
                    const file = event.target.files[0];
                    if (!file) return;

                    // æ£€æŸ¥æ–‡ä»¶ç±»å‹
                    if (!file.type.match(/video\/mp4/)) {
                        alert('åªæ”¯æŒmp4æ ¼å¼çš„è§†é¢‘');
                        return;
                    }

                    // æ£€æŸ¥æ–‡ä»¶å¤§å° (25MB = 25 * 1024 * 1024 bytes)
                    const maxSize = 25 * 1024 * 1024;
                    if (file.size > maxSize) {
                        alert('è§†é¢‘å¤§å°ä¸èƒ½è¶…è¿‡25MB');
                        return;
                    }

                    // è¯»å–å¹¶è½¬æ¢è§†é¢‘ä¸ºBase64
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        this.publishForm.videoUrl = e.target.result;
                    };
                    reader.readAsDataURL(file);
                },
                // åˆ é™¤è§†é¢‘
                removePublishVideo() {
                    this.publishForm.videoUrl = '';
                    if (this.$refs.publishVideoInput) {
                        this.$refs.publishVideoInput.value = '';
                    }
                },
                // å¤„ç†é“¾æ¥å°é¢ä¸Šä¼ 
                handlePublishLinkCoverUpload(event) {
                    const file = event.target.files[0];
                    if (!file) return;

                    // æ£€æŸ¥æ–‡ä»¶ç±»å‹
                    if (!file.type.match(/image\/(jpeg|jpg|png)/)) {
                        alert('åªæ”¯æŒjpg/pngæ ¼å¼çš„å›¾ç‰‡');
                        return;
                    }

                    // æ£€æŸ¥æ–‡ä»¶å¤§å° (5MB = 5 * 1024 * 1024 bytes)
                    const maxSize = 5 * 1024 * 1024;
                    if (file.size > maxSize) {
                        alert('å°é¢å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡5MB');
                        return;
                    }

                    // è¯»å–å¹¶è½¬æ¢å›¾ç‰‡ä¸ºBase64
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        this.publishForm.linkCoverUrl = e.target.result;
                    };
                    reader.readAsDataURL(file);
                },
                // åˆ é™¤é“¾æ¥å°é¢
                removePublishLinkCover() {
                    this.publishForm.linkCoverUrl = '';
                    if (this.$refs.publishLinkCoverInput) {
                        this.$refs.publishLinkCoverInput.value = '';
                    }
                },
                // è§£æé“¾æ¥åœ°å€
                parseLinkUrl() {
                    if (!this.publishForm.linkUrl) {
                        alert('è¯·å…ˆè¾“å…¥é“¾æ¥åœ°å€');
                        return;
                    }
                    // TODO: å®ç°é“¾æ¥è§£æåŠŸèƒ½,è‡ªåŠ¨è·å–æ ‡é¢˜ã€æè¿°ã€å°é¢ç­‰
                    alert('é“¾æ¥è§£æåŠŸèƒ½å¼€å‘ä¸­...');
                },
                async loadPublishTasks() {
                    this.publishTasksLoading = true;
                    try {
                        const token = localStorage.getItem('token');
                        const user = JSON.parse(localStorage.getItem('user') || '{}');

                        console.log('å¼€å§‹åŠ è½½ä»»åŠ¡åˆ—è¡¨, userId:', user.id);

                        const response = await fetch(`https://autochat.lfdhk.com/api/publish/tasks?userId=${user.id}`, {
                            headers: {
                                'Authorization': `Bearer ${token}`
                            }
                        });

                        console.log('APIå“åº”çŠ¶æ€:', response.status);
                        const result = await response.json();
                        console.log('APIå“åº”æ•°æ®:', result);

                        if (response.ok) {
                            // APIè¿”å›çš„æ•°æ®ç»“æ„æ˜¯ {success: true, data: {tasks: [...], total: ...}}
                            this.publishTasks = result.data?.tasks || result.data || [];
                            console.log('âœ… åŠ è½½ä»»åŠ¡åˆ—è¡¨æˆåŠŸ, ä»»åŠ¡æ•°é‡:', this.publishTasks.length);
                            console.log('ä»»åŠ¡åˆ—è¡¨:', this.publishTasks);
                        } else {
                            console.error('âŒ åŠ è½½ä»»åŠ¡åˆ—è¡¨å¤±è´¥:', result.message);
                            this.publishTasks = [];
                        }
                    } catch (error) {
                        console.error('âŒ åŠ è½½ä»»åŠ¡åˆ—è¡¨å¼‚å¸¸:', error);
                        this.publishTasks = [];
                    } finally {
                        this.publishTasksLoading = false;
                    }
                },
                formatDateTime(dateString) {
                    if (!dateString) return '-';

                    // è§£æUTCæ—¶é—´
                    let date = new Date(dateString);

                    // æ£€æŸ¥æ—¥æœŸæ˜¯å¦æœ‰æ•ˆ
                    if (isNaN(date.getTime())) {
                        return '-';
                    }

                    // å¦‚æœdateStringä¸åŒ…å«æ—¶åŒºä¿¡æ¯,Supabaseè¿”å›çš„æ˜¯UTCæ—¶é—´
                    // éœ€è¦è½¬æ¢ä¸ºæœ¬åœ°æ—¶é—´(åŒ—äº¬æ—¶é—´ = UTC+8)
                    if (!dateString.includes('+') && !dateString.includes('Z')) {
                        // å¦‚æœæ²¡æœ‰æ—¶åŒºæ ‡è¯†,æ‰‹åŠ¨æ·»åŠ Zè¡¨ç¤ºUTCæ—¶é—´
                        date = new Date(dateString + 'Z');
                    }

                    const year = date.getFullYear();
                    const month = String(date.getMonth() + 1).padStart(2, '0');
                    const day = String(date.getDate()).padStart(2, '0');
                    const hours = String(date.getHours()).padStart(2, '0');
                    const minutes = String(date.getMinutes()).padStart(2, '0');
                    const seconds = String(date.getSeconds()).padStart(2, '0');
                    return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
                },
                getStatusText(status) {
                    const statusMap = {
                        'pending': 'å¾…å‘å¸ƒ',
                        'processing': 'å‘å¸ƒä¸­',
                        'completed': 'å·²å®Œæˆ',
                        'failed': 'å¤±è´¥'
                    };
                    return statusMap[status] || status;
                },
                handleImageError(event) {
                    console.error('å›¾ç‰‡åŠ è½½å¤±è´¥:', event.target.src);
                    event.target.style.display = 'none';
                    const parent = event.target.parentElement;
                    if (parent) {
                        parent.innerHTML = '<div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #999; font-size: 12px;">åŠ è½½å¤±è´¥</div>';
                    }
                },
                openImage(url) {
                    window.open(url, '_blank');
                },
                handleLogout() {
                    if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—?')) {
                        // æ¸…é™¤ç™»å½•ä¿¡æ¯
                        localStorage.removeItem('token');
                        localStorage.removeItem('user');
                        // è·³è½¬åˆ°ç™»å½•é¡µé¢
                        window.location.href = 'login.html';
                    }
                },
                // æ‰§è¡Œè„šæœ¬1: è¾“å…¥é“¾æ¥è‡ªåŠ¨å‘å¸ƒ
                async executeScript1() {
                    if (!this.autoForm.script1.url) {
                        alert('è¯·è¾“å…¥å…¬ä¼—å·æ–‡ç« é“¾æ¥');
                        return;
                    }

                    if (!this.autoForm.script1.isImmediate && !this.autoForm.script1.publishTime) {
                        alert('è¯·é€‰æ‹©å‘å¸ƒæ—¶é—´');
                        return;
                    }

                    this.autoForm.script1Loading = true;
                    this.autoForm.script1Logs = []; // æ¸…ç©ºæ—¥å¿—

                    try {
                        console.log('ğŸš€ å¼€å§‹æ‰§è¡Œè„šæœ¬1: è¾“å…¥é“¾æ¥è‡ªåŠ¨å‘å¸ƒ');

                        // ğŸ”¥ ç¡®ä¿WebSocketå·²è¿æ¥
                        if (!this.socket || !this.socket.connected) {
                            console.log('âš ï¸ WebSocketæœªè¿æ¥,é‡æ–°åˆå§‹åŒ–...');
                            this.initWebSocket();
                            // ç­‰å¾…è¿æ¥å»ºç«‹
                            await new Promise(resolve => {
                                if (this.socket.connected) {
                                    resolve();
                                } else {
                                    this.socket.once('connect', resolve);
                                }
                            });
                            console.log('âœ… WebSocketè¿æ¥å·²å»ºç«‹');
                        }

                        // å‘é€POSTè¯·æ±‚
                        const response = await fetch('https://autochat.lfdhk.com/api/automation/script1/link-auto-publish', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                url: this.autoForm.script1.url,
                                userId: this.userId,
                                isImmediate: this.autoForm.script1.isImmediate,
                                publishTime: this.autoForm.script1.publishTime || '',
                                contentType: this.autoForm.script1.contentType,
                                selectedAccounts: this.autoForm.script1.selectedAccounts || [],
                                selectedTags: this.autoForm.script1.selectedTags || [],
                                useLocation: this.autoForm.script1.useLocation,
                                comments: this.autoForm.script1.comments ? this.autoForm.script1.comments.split(',') : [],
                                randomContent: this.autoForm.script1.randomContent || ''
                            })
                        });

                        const result = await response.json();
                        console.log('âœ… ä»»åŠ¡åˆ›å»ºæˆåŠŸ,ç­‰å¾…WebSocketæ¨é€æ—¥å¿—...');

                        if (!result.success) {
                            this.autoForm.script1Loading = false;
                            alert('âŒ ä»»åŠ¡åˆ›å»ºå¤±è´¥: ' + result.message);
                        }

                    } catch (error) {
                        console.error('âŒ è„šæœ¬1æ‰§è¡Œå¼‚å¸¸:', error);
                        this.autoForm.script1Loading = false;
                        alert('æ‰§è¡Œå¤±è´¥: ' + error.message);
                    }
                },

                // æ‰§è¡Œè„šæœ¬3: å®šæ—¶ç›‘æ§è‡ªåŠ¨å‘å¸ƒ
                async executeScript3() {
                    this.autoForm.script3Loading = true;
                    this.autoForm.script3Result = null;

                    try {
                        console.log('ğŸš€ å¼€å§‹æ‰§è¡Œè„šæœ¬3: å®šæ—¶ç›‘æ§è‡ªåŠ¨å‘å¸ƒ');

                        const response = await fetch('https://autochat.lfdhk.com/api/automation/script3/monitor-auto-publish', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                userId: this.userId,
                                accountIds: this.autoForm.script3.accountIds,
                                autoRewrite: this.autoForm.script3.autoRewrite,
                                autoPublish: this.autoForm.script3.autoPublish,
                                publishDelay: this.autoForm.script3.publishDelay,
                                contentType: this.autoForm.script3.contentType,
                                selectedAccounts: this.autoForm.script3.selectedAccounts,
                                selectedTags: this.autoForm.script3.selectedTags,
                                useLocation: this.autoForm.script3.useLocation,
                                comments: this.autoForm.script3.comments,
                                randomContent: this.autoForm.script3.randomContent
                            })
                        });

                        const result = await response.json();
                        this.autoForm.script3Result = result;

                        if (result.success) {
                            console.log('âœ… è„šæœ¬3æ‰§è¡ŒæˆåŠŸ!');
                        } else {
                            console.error('âŒ è„šæœ¬3æ‰§è¡Œå¤±è´¥:', result.message);
                        }
                    } catch (error) {
                        console.error('âŒ è„šæœ¬3æ‰§è¡Œå¼‚å¸¸:', error);
                        this.autoForm.script3Result = {
                            success: false,
                            message: 'æ‰§è¡Œå¤±è´¥: ' + error.message
                        };
                    } finally {
                        this.autoForm.script3Loading = false;
                    }
                },

                // æ‰§è¡Œè„šæœ¬4: è·Ÿåœˆè‡ªåŠ¨åŒ–
                async executeScript4() {
                    this.autoForm.script4Loading = true;
                    this.autoForm.script4Result = null;
                    this.autoForm.script4Logs = [];

                    try {
                        console.log('ğŸš€ å¼€å§‹æ‰§è¡Œè„šæœ¬4: è·Ÿåœˆè‡ªåŠ¨åŒ–');

                        // è‡ªåŠ¨åŒ¹é…å†…å®¹ç±»å‹
                        const contentType = this.autoForm.script4.images && this.autoForm.script4.images.length > 0 ? 'image' : 'text';
                        console.log('ğŸ“ è‡ªåŠ¨åŒ¹é…å†…å®¹ç±»å‹:', contentType);

                        // ğŸ”¥ ç¡®ä¿WebSocketå·²è¿æ¥
                        if (!this.socket || !this.socket.connected) {
                            console.log('âš ï¸ WebSocketæœªè¿æ¥,é‡æ–°åˆå§‹åŒ–...');
                            this.initWebSocket();
                            // ç­‰å¾…è¿æ¥å»ºç«‹
                            await new Promise(resolve => {
                                if (this.socket.connected) {
                                    resolve();
                                } else {
                                    this.socket.once('connect', resolve);
                                }
                            });
                            console.log('âœ… WebSocketè¿æ¥å·²å»ºç«‹');
                        }

                        // å‘é€POSTè¯·æ±‚åˆ›å»ºä»»åŠ¡
                        const response = await fetch('https://autochat.lfdhk.com/api/automation/script4/follow-circle', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                userId: this.userId, // ğŸ”¥ ä¼ é€’å½“å‰ç”¨æˆ·ID
                                content: this.autoForm.script4.content,
                                images: this.autoForm.script4.images,
                                contentType: contentType,
                                followCount: this.autoForm.script4.followCount,
                                intervalMinutes: this.autoForm.script4.intervalMinutes,
                                randomDelayMinutes: this.autoForm.script4.randomDelayMinutes || 0
                            })
                        });

                        const result = await response.json();
                        this.autoForm.script4Result = result;

                        // ä¸è¦è¦†ç›–æ—¥å¿—,WebSocketä¼šå®æ—¶æ¨é€
                        console.log('âœ… ä»»åŠ¡åˆ›å»ºæˆåŠŸ,ç­‰å¾…WebSocketæ¨é€æ—¥å¿—...');

                        if (!result.success) {
                            console.error('âŒ è„šæœ¬4æ‰§è¡Œå¤±è´¥:', result.message);
                            this.autoForm.script4Loading = false;
                        }
                    } catch (error) {
                        console.error('âŒ è„šæœ¬4æ‰§è¡Œå¼‚å¸¸:', error);
                        this.autoForm.script4Result = {
                            success: false,
                            message: 'æ‰§è¡Œå¤±è´¥: ' + error.message
                        };
                        this.autoForm.script4Loading = false;
                    }
                },

                // åœæ­¢è„šæœ¬4è·Ÿåœˆä»»åŠ¡
                async stopScript4() {
                    console.log('ğŸ” stopScript4è¢«è°ƒç”¨');
                    console.log('ğŸ” script4Loading:', this.autoForm.script4Loading);
                    console.log('ğŸ” script4Result:', this.autoForm.script4Result);

                    // è·å–ä»»åŠ¡ç»„ID
                    const taskGroupId = this.autoForm.script4Result?.taskGroupId;

                    if (!taskGroupId) {
                        alert('æ²¡æœ‰æ­£åœ¨æ‰§è¡Œçš„è·Ÿåœˆä»»åŠ¡!');
                        return;
                    }

                    if (!confirm('ç¡®å®šè¦åœæ­¢å½“å‰è·Ÿåœˆä»»åŠ¡å—?\n\nè¿™å°†åˆ é™¤æ‰€æœ‰æœªæ‰§è¡Œçš„ä»»åŠ¡,å·²å‘å¸ƒçš„æœ‹å‹åœˆå°†ä¿ç•™ã€‚')) {
                        return;
                    }

                    try {
                        console.log('ğŸ›‘ åœæ­¢è·Ÿåœˆä»»åŠ¡:', taskGroupId);

                        const response = await fetch('https://autochat.lfdhk.com/api/automation/script4/stop', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                taskGroupId: taskGroupId
                            })
                        });

                        const result = await response.json();

                        if (result.success) {
                            alert('âœ… è·Ÿåœˆä»»åŠ¡å·²åœæ­¢!');
                            this.autoForm.script4Result = null;
                            this.autoForm.script4Loading = false;
                            console.log('âœ… è·Ÿåœˆä»»åŠ¡å·²åœæ­¢');
                        } else {
                            alert('âŒ åœæ­¢å¤±è´¥: ' + result.message);
                            console.error('âŒ åœæ­¢å¤±è´¥:', result.message);
                        }
                    } catch (error) {
                        alert('âŒ åœæ­¢å¤±è´¥: ' + error.message);
                        console.error('âŒ åœæ­¢å¼‚å¸¸:', error);
                    }
                },

                // å¤„ç†è„šæœ¬4å›¾ç‰‡ä¸Šä¼ 
                handleScript4ImageUpload(event) {
                    const files = event.target.files;
                    if (!files || files.length === 0) return;

                    // æ£€æŸ¥å›¾ç‰‡æ•°é‡
                    if (this.autoForm.script4.images.length + files.length > 9) {
                        alert('æœ€å¤šåªèƒ½ä¸Šä¼ 9å¼ å›¾ç‰‡!');
                        return;
                    }

                    // è¯»å–å›¾ç‰‡å¹¶è½¬æ¢ä¸ºBase64
                    Array.from(files).forEach(file => {
                        // æ£€æŸ¥æ–‡ä»¶å¤§å° (15MB)
                        if (file.size > 15 * 1024 * 1024) {
                            alert(`å›¾ç‰‡ ${file.name} è¶…è¿‡15MB,è¯·å‹ç¼©åä¸Šä¼ !`);
                            return;
                        }

                        const reader = new FileReader();
                        reader.onload = (e) => {
                            this.autoForm.script4.images.push(e.target.result);
                        };
                        reader.readAsDataURL(file);
                    });

                    // æ¸…ç©ºinput,å…è®¸é‡å¤é€‰æ‹©åŒä¸€æ–‡ä»¶
                    event.target.value = '';
                },

                // åˆ é™¤è„šæœ¬4å›¾ç‰‡
                removeScript4Image(index) {
                    this.autoForm.script4.images.splice(index, 1);
                },

                saveCozeConfig() {
                    // TODO: è°ƒç”¨åç«¯APIä¿å­˜é…ç½®
                    alert('Cozeé…ç½®ä¿å­˜æˆåŠŸï¼');
                },
                saveFeishuConfig() {
                    // TODO: è°ƒç”¨åç«¯APIä¿å­˜é…ç½®
                    alert('é£ä¹¦é…ç½®ä¿å­˜æˆåŠŸï¼');
                },
                // å…¬ä¼—å·ç›‘æ§ç›¸å…³æ–¹æ³•
                async searchWechatAccount() {
                    if (!this.wechatMonitor.searchKeyword) {
                        alert('è¯·è¾“å…¥å…¬ä¼—å·åç§°');
                        return;
                    }

                    try {
                        const token = localStorage.getItem('token');
                        const response = await fetch(`https://autochat.lfdhk.com/api/wechat-monitor/search?keyword=${encodeURIComponent(this.wechatMonitor.searchKeyword)}`, {
                            headers: {
                                'Authorization': `Bearer ${token}`
                            }
                        });

                        if (response.ok) {
                            const data = await response.json();
                            this.wechatMonitor.searchResults = data;
                            if (data.length === 0) {
                                alert('æœªæ‰¾åˆ°ç›¸å…³å…¬ä¼—å·');
                            }
                        } else {
                            alert('æœç´¢å¤±è´¥ï¼');
                        }
                    } catch (error) {
                        console.error('æœç´¢å¤±è´¥:', error);
                        alert('æœç´¢å¤±è´¥ï¼');
                    }
                },
                async selectAccount(account) {
                    if (!confirm(`ç¡®å®šè¦è®¢é˜…"${account.mp_name}"å—ï¼Ÿ`)) {
                        return;
                    }

                    try {
                        const token = localStorage.getItem('token');
                        const response = await fetch('https://autochat.lfdhk.com/api/wechat-monitor/subscriptions', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${token}`
                            },
                            body: JSON.stringify({
                                mp_name: account.mp_name,
                                mp_id: account.mp_id,
                                mp_cover: account.mp_cover,
                                avatar: account.avatar,
                                mp_intro: account.mp_intro
                            })
                        });

                        if (response.ok) {
                            alert('æ·»åŠ è®¢é˜…æˆåŠŸï¼');
                            this.wechatMonitor.searchKeyword = '';
                            this.wechatMonitor.searchResults = [];
                            this.loadSubscriptions();
                        } else {
                            alert('æ·»åŠ è®¢é˜…å¤±è´¥ï¼');
                        }
                    } catch (error) {
                        console.error('æ·»åŠ è®¢é˜…å¤±è´¥:', error);
                        alert('æ·»åŠ è®¢é˜…å¤±è´¥ï¼');
                    }
                },
                async loadSubscriptions() {
                    try {
                        const token = localStorage.getItem('token');
                        const response = await fetch('https://autochat.lfdhk.com/api/wechat-monitor/subscriptions', {
                            headers: {
                                'Authorization': `Bearer ${token}`
                            }
                        });

                        if (response.ok) {
                            const data = await response.json();
                            this.wechatMonitor.subscriptions = data;
                        }
                    } catch (error) {
                        console.error('åŠ è½½è®¢é˜…åˆ—è¡¨å¤±è´¥:', error);
                    }
                },
                async deleteSubscription(id) {
                    if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªè®¢é˜…å—ï¼Ÿ')) {
                        return;
                    }

                    try {
                        const token = localStorage.getItem('token');
                        const response = await fetch(`https://autochat.lfdhk.com/api/wechat-monitor/subscriptions/${id}`, {
                            method: 'DELETE',
                            headers: {
                                'Authorization': `Bearer ${token}`
                            }
                        });

                        if (response.ok) {
                            alert('åˆ é™¤æˆåŠŸï¼');
                            this.loadSubscriptions();
                        } else {
                            alert('åˆ é™¤å¤±è´¥ï¼');
                        }
                    } catch (error) {
                        console.error('åˆ é™¤è®¢é˜…å¤±è´¥:', error);
                        alert('åˆ é™¤å¤±è´¥ï¼');
                    }
                },
                async triggerUpdate(id) {
                    try {
                        const token = localStorage.getItem('token');
                        const response = await fetch(`https://autochat.lfdhk.com/api/wechat-monitor/subscriptions/${id}/update`, {
                            method: 'POST',
                            headers: {
                                'Authorization': `Bearer ${token}`
                            }
                        });

                        if (response.ok) {
                            alert('æ›´æ–°æˆåŠŸï¼');
                            this.loadSubscriptions();
                        } else {
                            alert('æ›´æ–°å¤±è´¥ï¼');
                        }
                    } catch (error) {
                        console.error('è§¦å‘æ›´æ–°å¤±è´¥:', error);
                        alert('æ›´æ–°å¤±è´¥ï¼');
                    }
                },
                async loadArticles() {
                    try {
                        const token = localStorage.getItem('token');
                        const response = await fetch('https://autochat.lfdhk.com/api/wechat-monitor/articles', {
                            headers: {
                                'Authorization': `Bearer ${token}`
                            }
                        });

                        if (response.ok) {
                            const data = await response.json();
                            this.wechatMonitor.articles = data;
                        }
                    } catch (error) {
                        console.error('åŠ è½½æ–‡ç« åˆ—è¡¨å¤±è´¥:', error);
                    }
                },
                viewArticle(id) {
                    alert(`æŸ¥çœ‹æ–‡ç« è¯¦æƒ…: ${id}`);
                },
                openWechatMonitor() {
                    // è·³è½¬åˆ°æ–°çš„å…¬ä¼—å·ç›‘æ§é¡µé¢
                    window.location.href = 'wechat-subscription.html';
                },
                openArticles() {
                    // è·³è½¬åˆ°æ–‡ç« ç®¡ç†é¡µé¢
                    window.location.href = 'articles.html';
                },
                openMonitorConfig() {
                    // è·³è½¬åˆ°ç›‘æ§é…ç½®é¡µé¢
                    window.location.href = 'monitor-config.html';
                },
                // å¤„ç†æ¥è‡ªiframeçš„æ¶ˆæ¯
                handleMessage(event) {
                    // å®‰å…¨æ£€æŸ¥:ç¡®ä¿æ¶ˆæ¯æ¥è‡ªå¯ä¿¡æº
                    // åœ¨ç”Ÿäº§ç¯å¢ƒä¸­åº”è¯¥æ£€æŸ¥event.origin

                    if (event.data && event.data.action === 'goToRewrite') {
                        // ä»localStorageè·å–è½¬å†™æ•°æ®
                        const rewriteData = JSON.parse(localStorage.getItem('rewriteData') || '{}');

                        if (rewriteData.content) {
                            // å¡«å……è½¬å†™è¡¨å•
                            this.rewriteForm.articleId = rewriteData.articleId;
                            this.rewriteForm.original = rewriteData.content;
                            this.rewriteForm.images = rewriteData.images || [];
                            this.rewriteForm.selectedImages = [...(rewriteData.images || [])];  // é»˜è®¤é€‰ä¸­æ‰€æœ‰å›¾ç‰‡

                            // åˆ‡æ¢åˆ°è½¬å†™é¡µé¢
                            this.currentPage = 'rewrite';
                            this.menuGroups.manual = true;  // å±•å¼€æ‰‹åŠ¨æ¨¡å¼èœå•
                        }
                    }
                },
                // åˆ é™¤å›¾ç‰‡
                removeImage(index) {
                    this.rewriteForm.selectedImages.splice(index, 1);
                },
                // ä¸Šç§»å›¾ç‰‡
                moveImageUp(index) {
                    if (index > 0) {
                        const temp = this.rewriteForm.selectedImages[index];
                        this.rewriteForm.selectedImages[index] = this.rewriteForm.selectedImages[index - 1];
                        this.rewriteForm.selectedImages[index - 1] = temp;
                    }
                },
                // ä¸‹ç§»å›¾ç‰‡
                moveImageDown(index) {
                    if (index < this.rewriteForm.selectedImages.length - 1) {
                        const temp = this.rewriteForm.selectedImages[index];
                        this.rewriteForm.selectedImages[index] = this.rewriteForm.selectedImages[index + 1];
                        this.rewriteForm.selectedImages[index + 1] = temp;
                    }
                },
                // æ˜¾ç¤ºæ·»åŠ å›¾ç‰‡èœå•
                showAddImageMenu() {
                    const choice = confirm('ç‚¹å‡»"ç¡®å®š"ä¸Šä¼ æœ¬åœ°å›¾ç‰‡\nç‚¹å‡»"å–æ¶ˆ"è¾“å…¥å›¾ç‰‡URL');
                    if (choice) {
                        // ä¸Šä¼ æœ¬åœ°å›¾ç‰‡
                        this.triggerImageUpload();
                    } else {
                        // è¾“å…¥URL
                        this.addImageUrl();
                    }
                },
                // è§¦å‘æ–‡ä»¶ä¸Šä¼ 
                triggerImageUpload() {
                    this.$refs.imageUpload.click();
                },
                // å¤„ç†å›¾ç‰‡ä¸Šä¼ 
                handleImageUpload(event) {
                    const file = event.target.files[0];
                    if (!file) return;

                    // æ£€æŸ¥æ–‡ä»¶ç±»å‹
                    if (!file.type.startsWith('image/')) {
                        alert('è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶!');
                        return;
                    }

                    // æ£€æŸ¥æ–‡ä»¶å¤§å°(é™åˆ¶5MB)
                    if (file.size > 5 * 1024 * 1024) {
                        alert('å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡5MB!');
                        return;
                    }

                    // ä½¿ç”¨FileReaderè¯»å–å›¾ç‰‡å¹¶è½¬æ¢ä¸ºBase64
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        // æ·»åŠ Base64å›¾ç‰‡åˆ°åˆ—è¡¨
                        this.rewriteForm.selectedImages.push(e.target.result);
                    };
                    reader.onerror = () => {
                        alert('å›¾ç‰‡è¯»å–å¤±è´¥,è¯·é‡è¯•!');
                    };
                    reader.readAsDataURL(file);

                    // æ¸…ç©ºinput,å…è®¸é‡å¤é€‰æ‹©åŒä¸€æ–‡ä»¶
                    event.target.value = '';
                },
                // æ·»åŠ å›¾ç‰‡URL(ä¿ç•™æ­¤æ–¹æ³•,å¯ä»¥é€šè¿‡å…¶ä»–æ–¹å¼è°ƒç”¨)
                addImageUrl() {
                    const url = prompt('è¯·è¾“å…¥å›¾ç‰‡URL:');
                    if (url && url.trim()) {
                        this.rewriteForm.selectedImages.push(url.trim());
                    }
                },

                // ========== å †é›ªçƒè´¦å·ç®¡ç†æ–¹æ³• ==========

                // åŠ è½½å †é›ªçƒè´¦å·åˆ—è¡¨
                async loadDuixueqiuAccounts() {
                    this.duixueqiuAccountsLoading = true;
                    try {
                        // ğŸ”¥ ä½¿ç”¨å½“å‰ç™»å½•ç”¨æˆ·çš„çœŸå®ID
                        const response = await fetch(`https://autochat.lfdhk.com/api/duixueqiu-accounts?userId=${this.userId}`);
                        const result = await response.json();

                        if (result.success) {
                            this.duixueqiuAccounts = result.data;
                        } else {
                            alert('åŠ è½½å †é›ªçƒè´¦å·å¤±è´¥: ' + result.message);
                        }
                    } catch (error) {
                        console.error('åŠ è½½å †é›ªçƒè´¦å·å¤±è´¥:', error);
                        alert('åŠ è½½å †é›ªçƒè´¦å·å¤±è´¥: ' + error.message);
                    } finally {
                        this.duixueqiuAccountsLoading = false;
                    }
                },

                // æ˜¾ç¤ºæ·»åŠ è´¦å·è¡¨å•
                showAddDuixueqiuAccountForm() {
                    this.duixueqiuAccountForm = {
                        id: null,
                        username: '',
                        password: ''
                    };
                    this.duixueqiuAccountFormVisible = true;
                },

                // æ˜¾ç¤ºç¼–è¾‘è´¦å·è¡¨å•
                showEditDuixueqiuAccountForm(account) {
                    this.duixueqiuAccountForm = {
                        id: account.id,
                        username: account.username,
                        password: '' // å¯†ç ä¸å›æ˜¾,éœ€è¦é‡æ–°è¾“å…¥
                    };
                    this.duixueqiuAccountFormVisible = true;
                },

                // ä¿å­˜å †é›ªçƒè´¦å·
                async saveDuixueqiuAccount() {
                    if (!this.duixueqiuAccountForm.username) {
                        alert('è¯·è¾“å…¥å †é›ªçƒç”¨æˆ·å');
                        return;
                    }

                    if (!this.duixueqiuAccountForm.password) {
                        alert('è¯·è¾“å…¥å †é›ªçƒå¯†ç ');
                        return;
                    }

                    this.duixueqiuAccountFormLoading = true;
                    try {
                        const isEdit = !!this.duixueqiuAccountForm.id;
                        const url = isEdit
                            ? `https://autochat.lfdhk.com/api/duixueqiu-accounts/${this.duixueqiuAccountForm.id}`
                            : 'https://autochat.lfdhk.com/api/duixueqiu-accounts';
                        const method = isEdit ? 'PUT' : 'POST';

                        const response = await fetch(url, {
                            method: method,
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                userId: this.userId, // ğŸ”¥ ä½¿ç”¨å½“å‰ç™»å½•ç”¨æˆ·çš„çœŸå®ID
                                username: this.duixueqiuAccountForm.username,
                                password: this.duixueqiuAccountForm.password
                            })
                        });

                        const result = await response.json();

                        if (result.success) {
                            alert(result.message);
                            this.duixueqiuAccountFormVisible = false;
                            await this.loadDuixueqiuAccounts(); // é‡æ–°åŠ è½½åˆ—è¡¨
                        } else {
                            alert('ä¿å­˜å¤±è´¥: ' + result.message);
                        }
                    } catch (error) {
                        console.error('ä¿å­˜å †é›ªçƒè´¦å·å¤±è´¥:', error);
                        alert('ä¿å­˜å¤±è´¥: ' + error.message);
                    } finally {
                        this.duixueqiuAccountFormLoading = false;
                    }
                },

                // åˆ é™¤å †é›ªçƒè´¦å·
                async deleteDuixueqiuAccount(accountId) {
                    if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå †é›ªçƒè´¦å·å—?')) {
                        return;
                    }

                    try {
                        // ğŸ”¥ ä½¿ç”¨å½“å‰ç™»å½•ç”¨æˆ·çš„çœŸå®ID
                        const response = await fetch(`https://autochat.lfdhk.com/api/duixueqiu-accounts/${accountId}?userId=${this.userId}`, {
                            method: 'DELETE'
                        });

                        const result = await response.json();

                        if (result.success) {
                            alert('åˆ é™¤æˆåŠŸ');
                            await this.loadDuixueqiuAccounts(); // é‡æ–°åŠ è½½åˆ—è¡¨
                        } else {
                            alert('åˆ é™¤å¤±è´¥: ' + result.message);
                        }
                    } catch (error) {
                        console.error('åˆ é™¤å †é›ªçƒè´¦å·å¤±è´¥:', error);
                        alert('åˆ é™¤å¤±è´¥: ' + error.message);
                    }
                },

                // æ ¼å¼åŒ–æ—¥æœŸ
                formatDate(dateString) {
                    if (!dateString) return '-';
                    const date = new Date(dateString);
                    return date.toLocaleString('zh-CN', {
                        year: 'numeric',
                        month: '2-digit',
                        day: '2-digit',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                },

                // ğŸ”¥ åˆå§‹åŒ–WebSocketè¿æ¥
                initWebSocket() {
                    if (this.socket) {
                        console.log('âš ï¸ WebSocketå·²å­˜åœ¨,è·³è¿‡åˆå§‹åŒ–');
                        return;
                    }

                    console.log('ğŸ“¡ åˆå§‹åŒ–WebSocketè¿æ¥...');
                    this.socket = io('https://autochat.lfdhk.com/automation', {
                        path: '/socket.io',
                        transports: ['websocket', 'polling']
                    });

                    // ç›‘å¬è¿æ¥æˆåŠŸ
                    this.socket.on('connect', () => {
                        console.log('âœ… WebSocketè¿æ¥æˆåŠŸ, ID:', this.socket.id);
                    });

                    // ç›‘å¬è¿æ¥é”™è¯¯
                    this.socket.on('connect_error', (error) => {
                        console.error('âŒ WebSocketè¿æ¥å¤±è´¥:', error);
                    });

                    // ç›‘å¬è·Ÿåœˆæ—¥å¿—
                    this.socket.on('followCircleLog', (data) => {
                        console.log('ğŸ“¨ æ”¶åˆ°æ—¥å¿—:', data);
                        this.autoForm.script4Logs.push(data.log);

                        // è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨
                        this.$nextTick(() => {
                            const logContainer = document.querySelector('.card[style*="max-height: 300px"]');
                            if (logContainer) {
                                logContainer.scrollTop = logContainer.scrollHeight;
                            }
                        });
                    });

                    // ç›‘å¬ä»»åŠ¡å®Œæˆ
                    this.socket.on('followCircleComplete', (data) => {
                        console.log('ğŸ‰ ä»»åŠ¡å®Œæˆ:', data);
                        this.autoForm.script4Loading = false;

                        if (data.success) {
                            // æ¸…ç©ºè¡¨å•
                            this.autoForm.script4.content = '';
                            this.autoForm.script4.images = [];
                            this.autoForm.script4.followCount = 2;
                            this.autoForm.script4.intervalMinutes = 1;
                        }

                        alert(data.success ? 'âœ… è·Ÿåœˆä»»åŠ¡å…¨éƒ¨å®Œæˆ!' : 'âŒ ä»»åŠ¡å¤±è´¥: ' + data.message);
                    });

                    // ğŸ”¥ ç›‘å¬è„šæœ¬1æ—¥å¿—
                    this.socket.on('script1Log', (data) => {
                        console.log('ğŸ“¨ æ”¶åˆ°è„šæœ¬1æ—¥å¿—:', data);
                        this.autoForm.script1Logs.push(data.log);

                        // è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨
                        this.$nextTick(() => {
                            const logContainer = document.querySelector('.card[style*="max-height: 400px"]');
                            if (logContainer) {
                                logContainer.scrollTop = logContainer.scrollHeight;
                            }
                        });
                    });

                    // ğŸ”¥ ç›‘å¬è„šæœ¬1ä»»åŠ¡å®Œæˆ
                    this.socket.on('script1Complete', (data) => {
                        console.log('ğŸ‰ è„šæœ¬1ä»»åŠ¡å®Œæˆ:', data);
                        this.autoForm.script1Loading = false;

                        if (data.success) {
                            alert('âœ… è‡ªåŠ¨å‘å¸ƒæµç¨‹æ‰§è¡ŒæˆåŠŸ!');
                        } else {
                            alert('âŒ ä»»åŠ¡å¤±è´¥: ' + data.message);
                        }
                    });
                }
            },
            mounted() {
                // æ£€æŸ¥ç™»å½•çŠ¶æ€
                const token = localStorage.getItem('token');
                if (!token) {
                    // æœªç™»å½•,è·³è½¬åˆ°ç™»å½•é¡µé¢
                    window.location.href = 'login.html';
                    return;
                }

                // è·å–ç”¨æˆ·ä¿¡æ¯
                const user = JSON.parse(localStorage.getItem('user') || '{}');
                if (user.name) {
                    this.userName = user.name;
                    this.userAvatar = user.name.charAt(0);
                }
                if (user.id) {
                    this.userId = user.id;
                }

                // ğŸ”¥ ç«‹å³å»ºç«‹WebSocketè¿æ¥
                this.initWebSocket();

                // åŠ è½½å…¬ä¼—å·ç›‘æ§æ•°æ®
                this.loadSubscriptions();
                this.loadArticles();

                // åŠ è½½å‘å¸ƒä»»åŠ¡åˆ—è¡¨
                this.loadPublishTasks();

                // åŠ è½½å †é›ªçƒè´¦å·åˆ—è¡¨
                this.loadDuixueqiuAccounts();

                // ç›‘å¬æ¥è‡ªiframeçš„æ¶ˆæ¯
                window.addEventListener('message', this.handleMessage);
            },
            beforeUnmount() {
                // ç§»é™¤æ¶ˆæ¯ç›‘å¬å™¨
                window.removeEventListener('message', this.handleMessage);
            }
        }).mount('#app');
    </script>
</body>
</html>

