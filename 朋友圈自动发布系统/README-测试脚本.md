# 堆雪球点击测试脚本使用说明

## 📋 功能说明

这个测试脚本用于调试堆雪球微信号点击问题,会:

1. ✅ 自动登录堆雪球
2. ✅ 等待微信号列表加载
3. ✅ 显示所有微信号信息
4. ✅ 点击指定的微信号(1号机)
5. ✅ 实时监控未分组数字变化
6. ✅ **每一步都会截图保存**
7. ✅ 浏览器窗口可见,可以直接观察

## 🚀 使用方法

### 1. 进入项目目录

```bash
cd "朋友圈自动发布系统"
```

### 2. 安装依赖(如果还没安装)

```bash
npm install puppeteer
```

### 3. 运行测试脚本

```bash
node test-duixueqiu-click.js
```

### 4. 观察输出

脚本会在控制台输出详细的执行日志,例如:

```
🚀 启动Puppeteer测试...

📝 步骤1: 登录堆雪球
📸 截图保存: screenshots/1_登录页面.png
📸 截图保存: screenshots/2_填写账号密码.png
✅ 登录成功
📸 截图保存: screenshots/3_登录成功.png

📝 步骤2: 等待页面加载
📸 截图保存: screenshots/4_页面加载完成.png

📝 步骤3: 等待微信号列表渲染
✅ Vue已渲染完成! 找到 17 个微信号
📸 截图保存: screenshots/5_微信号列表渲染完成.png

📝 步骤4: 获取所有微信号
📋 微信号列表:
  0: 10号机 | title=沪港纪老板(10号机) | selected=true
  1: 1号机 | title=沪港纪老板(1号机) | selected=false
  2: 3号机 | title=沪港纪老板(3号机) | selected=false
  ...

📝 步骤5: 读取点击前的未分组数字
📊 点击前的未分组好友数: 9948
📸 截图保存: screenshots/6_点击前_未分组9948.png

📝 步骤6: 点击微信号 "1号机"
✅ 已点击微信号: 1号机
📸 截图保存: screenshots/7_点击后_立即截图.png

📝 步骤7: 等待好友数据更新
  检查 1: 当前未分组数 = 9948
  检查 2: 当前未分组数 = 9948
  检查 3: 当前未分组数 = 6396
✅ 好友数据已更新! 从 9948 变为 6396 (耗时0.6秒)
✅ 好友数匹配! 当前: 6396, 期望: 6396
📸 截图保存: screenshots/8_数据更新后_未分组6396.png

📝 步骤8: 验证当前选中的微信号
🔍 当前选中的微信号: 1号机 (沪港纪老板(1号机))
📸 截图保存: screenshots/9_最终状态.png

✅ 测试完成! 请查看screenshots目录中的截图
📁 截图目录: /path/to/朋友圈自动发布系统/screenshots

⏸️  浏览器将保持打开状态,按Ctrl+C退出...
```

### 5. 查看截图

所有截图保存在 `朋友圈自动发布系统/screenshots/` 目录中,按执行顺序编号:

- `1_登录页面.png`
- `2_填写账号密码.png`
- `3_登录成功.png`
- `4_页面加载完成.png`
- `5_微信号列表渲染完成.png`
- `6_点击前_未分组9948.png`
- `7_点击后_立即截图.png`
- `8_数据更新后_未分组6396.png`
- `9_最终状态.png`

## 🔧 修改配置

如果需要测试其他微信号,可以修改脚本开头的配置:

```javascript
const TARGET_ACCOUNT = '2号机'; // 改成要测试的微信号
const EXPECTED_FRIENDS_COUNT = 7000; // 改成期望的好友数
```

## 📊 问题诊断

### 如果点击后数字没变化

可能原因:
1. 点击的元素不对
2. 点击事件没有触发
3. 页面需要更长的加载时间

**解决方法:** 查看截图 `7_点击后_立即截图.png`,看看左侧微信号是否有`selected`样式

### 如果数字变了但不是期望值

可能原因:
1. 点击了错误的微信号
2. 微信号的顺序和预期不一致

**解决方法:** 查看步骤4的输出,确认微信号列表的顺序

### 如果浏览器没有打开

可能原因:
1. Puppeteer没有正确安装
2. Chrome/Chromium没有安装

**解决方法:**
```bash
# 重新安装Puppeteer
npm install puppeteer --force
```

## 🎯 预期结果

**成功的情况:**
- ✅ 点击前: 未分组数 = 9948 (或0)
- ✅ 点击后: 未分组数 = 6396
- ✅ 好友数匹配
- ✅ 当前选中: 1号机

**失败的情况:**
- ❌ 点击前: 未分组数 = 9948
- ❌ 点击后: 未分组数 = 9948 (没变化)
- ❌ 或者变成了其他数字(不是6396)

## 💡 提示

- 脚本运行时浏览器窗口会保持打开,可以直接观察操作过程
- 按 `Ctrl+C` 可以随时停止脚本
- 每次运行会覆盖之前的截图
- 如果需要保留截图,请先备份 `screenshots` 目录

