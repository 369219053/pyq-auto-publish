# 本地测试快速参考卡片

> **目标**: 在本地充分测试Puppeteer功能,看到浏览器操作过程,确认无误后再部署到服务器

---

## 🚀 快速开始 (3步)

### 1️⃣ 配置环境变量

编辑 `pyq-backend/.env` 文件,添加:

```env
PUPPETEER_HEADLESS=false
```

**作用**: 显示浏览器窗口,可以看到Puppeteer的操作过程

---

### 2️⃣ 启动本地服务

```bash
cd 朋友圈自动发布系统/pyq-backend
npm run start:dev
```

**验证**: 看到 `Nest application successfully started` 说明启动成功

---

### 3️⃣ 测试功能

**方法A: 通过前端页面**

```bash
# 启动前端
cd pyq-frontend-vben
pnpm dev:antd

# 访问 http://localhost:5666
# 登录后进入相应功能页面测试
```

**方法B: 使用测试脚本**

```bash
# 测试微信好友同步
node test-wechat-sync.js

# 测试视频号素材
node test-video-material-dialog.js
```

**观察**: 会弹出浏览器窗口,可以看到每一步操作!

---

## 📋 完整流程

```
1. 修改代码
   ↓
2. 配置 PUPPETEER_HEADLESS=false
   ↓
3. 启动本地服务 (npm run start:dev)
   ↓
4. 测试功能 (观察浏览器操作)
   ↓
5. 修复问题 (快速迭代)
   ↓
6. 确认无误
   ↓
7. 提交代码 (git commit)
   ↓
8. 部署到服务器 (./deploy-update.sh)
   ↓
9. 验证生产环境 (pm2 logs)
```

---

## ⚠️ 重要提醒

### ✅ 本地测试时

- `PUPPETEER_HEADLESS=false` - 显示浏览器
- 可以看到每一步操作
- 可以打开开发者工具调试
- 可以设置slowMo减慢速度

### ❌ 部署到服务器时

- 服务器 `.env` 使用 `PUPPETEER_HEADLESS=true` (或不设置)
- 无头模式,不显示浏览器
- 节省服务器资源
- 通过日志和截图调试

---

## 🔧 调试技巧

### 1. 减慢操作速度

```javascript
const browser = await puppeteer.launch({
  headless: false,
  slowMo: 500,  // 每个操作延迟500ms
});
```

### 2. 自动打开开发者工具

```javascript
const browser = await puppeteer.launch({
  headless: false,
  devtools: true,  // 自动打开开发者工具
});
```

### 3. 保持浏览器打开

```javascript
// 测试脚本最后添加
console.log('✅ 测试完成,浏览器保持打开');
await new Promise(() => {}); // 永久等待
```

---

## 📚 详细文档

完整的本地测试指南请查看: [本地测试指南.md](./项目文档整理/本地测试指南.md)

---

**最后更新**: 2025-11-15
**维护者**: 小牛马

