# 微信号同步测试脚本使用说明

## 📋 脚本说明

`test-wechat-sync.js` 是一个本地测试脚本,用于调试Puppeteer自动化操作堆雪球系统获取微信号列表的过程。

## 🚀 运行方式

### 1. 进入项目目录

```bash
cd /Users/apple/Desktop/编程专用/纪总朋友圈智能体/朋友圈自动发布系统
```

### 2. 安装依赖(如果还没安装)

```bash
npm install puppeteer
```

### 3. 运行测试脚本

```bash
node test-wechat-sync.js
```

## 🔍 脚本功能

### 主要功能

1. **启动浏览器** - 以非无头模式启动,可以看到浏览器操作过程
2. **登录堆雪球** - 自动输入账号密码并登录
3. **查找账号按钮** - 尝试多种选择器查找账号管理按钮
4. **获取微信号列表** - 点击账号按钮,获取所有微信号
5. **输出调试信息** - 详细的日志输出,方便排查问题
6. **截图保存** - 如果出错会自动截图保存

### 输出信息

脚本会输出以下信息:

- ✅ 成功步骤的提示
- ❌ 失败步骤的错误信息
- 🔍 查找元素的过程
- 📱 找到的微信号列表
- 📸 截图文件路径

### 生成的文件

- `debug-page.png` - 调试截图(如果未找到账号按钮)
- `error-page.png` - 错误截图(如果操作失败)

## 🐛 调试技巧

### 1. 查看浏览器操作

脚本运行时会打开浏览器窗口,您可以:
- 看到自动登录的过程
- 看到点击账号按钮的操作
- 看到微信号列表的显示

### 2. 查看控制台输出

脚本会输出详细的日志:
```
🚀 开始测试微信号同步功能
🌐 启动浏览器...
🔐 开始登录堆雪球系统...
✅ 已输入账号密码
🔄 等待登录完成...
✅ 登录成功!
📱 开始获取微信号列表...
🔍 查找账号管理按钮...
✅ 找到账号按钮: .el-dropdown-link
🖱️ 点击账号管理按钮...
🔍 查找微信号列表...
✅ 成功获取 17 个微信号:
  1. 沪港纪老板(1号机)
  2. 沪港纪老板(2号机)
  ...
```

### 3. 查看截图

如果脚本失败,会自动保存截图:
- `debug-page.png` - 页面状态截图
- `error-page.png` - 错误时的截图

### 4. 修改脚本

您可以修改脚本中的参数:

```javascript
// 修改等待时间(毫秒)
await page.waitForTimeout(3000);  // 改为更长时间

// 修改浏览器窗口大小
defaultViewport: {
  width: 1920,
  height: 1080
}

// 修改选择器
const selectors = [
  '.el-dropdown-link',
  // 添加新的选择器
];
```

## 🔧 常见问题

### 问题1: 找不到账号管理按钮

**原因**: 页面结构可能发生变化,选择器不匹配

**解决方案**:
1. 查看 `debug-page.png` 截图
2. 在浏览器中手动打开堆雪球系统
3. 使用开发者工具(F12)查看账号按钮的实际选择器
4. 修改脚本中的 `selectors` 数组

### 问题2: 登录失败

**原因**: 账号密码错误或页面加载超时

**解决方案**:
1. 检查账号密码是否正确
2. 增加等待时间: `await page.waitForTimeout(5000)`
3. 检查网络连接

### 问题3: 获取到0个微信号

**原因**: 微信号列表的选择器不匹配

**解决方案**:
1. 在浏览器中手动点击账号按钮
2. 使用开发者工具查看微信号列表的HTML结构
3. 修改脚本中的选择器: `[title*="号机"], [title*="助理"]`

## 📝 下一步

根据测试结果:

1. **如果成功获取到微信号** - 说明选择器正确,可以更新后端代码
2. **如果获取到0个微信号** - 需要调整选择器,查看截图和HTML结构
3. **如果登录失败** - 检查账号密码和网络连接

## 💡 提示

- 脚本会保持浏览器打开30秒,方便您查看页面状态
- 可以修改 `headless: false` 为 `headless: true` 来隐藏浏览器窗口
- 可以修改等待时间来适应不同的网络速度

