# æœåŠ¡å™¨å¸¸ç”¨å‘½ä»¤æ‰‹å†Œ

## ğŸ“‹ ç›®å½•
- [PM2è¿›ç¨‹ç®¡ç†](#pm2è¿›ç¨‹ç®¡ç†)
- [æ—¥å¿—æŸ¥çœ‹](#æ—¥å¿—æŸ¥çœ‹)
- [æœåŠ¡é‡å¯](#æœåŠ¡é‡å¯)
- [ç«¯å£æ£€æŸ¥](#ç«¯å£æ£€æŸ¥)
- [Dockerç®¡ç†](#dockerç®¡ç†)
- [æ•°æ®åº“æ“ä½œ](#æ•°æ®åº“æ“ä½œ)
- [æ–‡ä»¶æ“ä½œ](#æ–‡ä»¶æ“ä½œ)
- [ç³»ç»Ÿç›‘æ§](#ç³»ç»Ÿç›‘æ§)

---

## ğŸ”§ PM2è¿›ç¨‹ç®¡ç†

### æŸ¥çœ‹æ‰€æœ‰è¿›ç¨‹
```bash
pm2 list
```

### æŸ¥çœ‹è¿›ç¨‹è¯¦æƒ…
```bash
pm2 show pyq-backend
```

### é‡å¯æœåŠ¡
```bash
pm2 restart pyq-backend
```

### åœæ­¢æœåŠ¡
```bash
pm2 stop pyq-backend
```

### å¯åŠ¨æœåŠ¡
```bash
pm2 start pyq-backend
```

### åˆ é™¤è¿›ç¨‹
```bash
pm2 delete pyq-backend
```

### ä¿å­˜PM2é…ç½®
```bash
pm2 save
```

### è®¾ç½®å¼€æœºè‡ªå¯
```bash
pm2 startup
pm2 save
```

---

## ğŸ“Š æ—¥å¿—æŸ¥çœ‹

### æŸ¥çœ‹å®æ—¶æ—¥å¿—
```bash
pm2 logs pyq-backend
```

### æŸ¥çœ‹æœ€è¿‘100è¡Œæ—¥å¿—
```bash
pm2 logs pyq-backend --lines 100
```

### æŸ¥çœ‹é”™è¯¯æ—¥å¿—
```bash
pm2 logs pyq-backend --err
```

### æŸ¥çœ‹è¾“å‡ºæ—¥å¿—
```bash
pm2 logs pyq-backend --out
```

### æ¸…ç©ºæ—¥å¿—
```bash
pm2 flush pyq-backend
```

### æŸ¥çœ‹è·Ÿåœˆç›¸å…³æ—¥å¿—
```bash
pm2 logs pyq-backend --lines 200 | grep "è·Ÿåœˆ"
```

### æŸ¥çœ‹å‘å¸ƒç›¸å…³æ—¥å¿—
```bash
pm2 logs pyq-backend --lines 200 | grep "å‘å¸ƒ"
```

### æŸ¥çœ‹é”™è¯¯æ—¥å¿—
```bash
pm2 logs pyq-backend --lines 200 | grep "ERROR"
```

---

## ğŸ”„ æœåŠ¡é‡å¯

### å¿«é€Ÿé‡å¯
```bash
pm2 restart pyq-backend
```

### é‡å¯å¹¶æ¸…ç©ºæ—¥å¿—
```bash
pm2 flush pyq-backend
pm2 restart pyq-backend
```

### é‡å¯Nginx
```bash
nginx -s reload
```

### é‡å¯Nginx (å¼ºåˆ¶)
```bash
systemctl restart nginx
```

---

## ğŸ” ç«¯å£æ£€æŸ¥

### æŸ¥çœ‹æ‰€æœ‰ç›‘å¬ç«¯å£
```bash
netstat -tlnp
```

### æŸ¥çœ‹3000ç«¯å£å ç”¨
```bash
netstat -tlnp | grep :3000
```

### æŸ¥çœ‹443ç«¯å£å ç”¨
```bash
netstat -tlnp | grep :443
```

### æŸ¥çœ‹80ç«¯å£å ç”¨
```bash
netstat -tlnp | grep :80
```

### æŸ¥çœ‹8001ç«¯å£å ç”¨ (we-mp-rss)
```bash
netstat -tlnp | grep :8001
```

### æŸ¥çœ‹è¿›ç¨‹å ç”¨ç«¯å£
```bash
lsof -i :3000
```

### æ€æ­»å ç”¨ç«¯å£çš„è¿›ç¨‹
```bash
# å…ˆæŸ¥æ‰¾PID
netstat -tlnp | grep :3000
# ç„¶åæ€æ­»è¿›ç¨‹
kill -9 [PID]
```

---

## ğŸ³ Dockerç®¡ç†

### æŸ¥çœ‹æ‰€æœ‰å®¹å™¨
```bash
docker ps -a
```

### æŸ¥çœ‹è¿è¡Œä¸­çš„å®¹å™¨
```bash
docker ps
```

### æŸ¥çœ‹é•œåƒåˆ—è¡¨
```bash
docker images
```

### å¯åŠ¨we-mp-rsså®¹å™¨
```bash
docker start we-mp-rss
```

### åœæ­¢we-mp-rsså®¹å™¨
```bash
docker stop we-mp-rss
```

### é‡å¯we-mp-rsså®¹å™¨
```bash
docker restart we-mp-rss
```

### æŸ¥çœ‹å®¹å™¨æ—¥å¿—
```bash
docker logs we-mp-rss
```

### æŸ¥çœ‹å®¹å™¨å®æ—¶æ—¥å¿—
```bash
docker logs -f we-mp-rss
```

### è¿›å…¥å®¹å™¨å†…éƒ¨
```bash
docker exec -it we-mp-rss /bin/sh
```

### åˆ é™¤å®¹å™¨
```bash
docker rm we-mp-rss
```

### åˆ é™¤é•œåƒ
```bash
docker rmi ghcr.io/rachelos/we-mp-rss:latest
```

### æ‹‰å–æœ€æ–°é•œåƒ
```bash
docker pull ghcr.io/rachelos/we-mp-rss:latest
```

### æŸ¥çœ‹é•œåƒä¸‹è½½è¿›åº¦
```bash
tail -f /tmp/docker-pull.log
```

---

## ğŸ’¾ æ•°æ®åº“æ“ä½œ

### è¿æ¥æ•°æ®åº“ (å®å¡”PostgreSQL)
```bash
/www/server/pgsql/bin/psql -U postgres -d autochat
```

### æŸ¥çœ‹æ‰€æœ‰è¡¨
```sql
\dt
```

### æŸ¥çœ‹è¡¨ç»“æ„
```sql
\d follow_circle_tasks
```

### æŸ¥è¯¢è·Ÿåœˆä»»åŠ¡
```sql
SELECT task_group_id, circle_index, delete_previous, previous_title, status, publish_time
FROM follow_circle_tasks
WHERE status = 'pending'
ORDER BY publish_time;
```

### æŸ¥è¯¢æœ€è¿‘çš„ä»»åŠ¡
```sql
SELECT * FROM follow_circle_tasks
ORDER BY created_at DESC
LIMIT 10;
```

### åˆ é™¤æ‰€æœ‰å¾…æ‰§è¡Œä»»åŠ¡
```sql
DELETE FROM follow_circle_tasks WHERE status = 'pending';
```

### é€€å‡ºæ•°æ®åº“
```sql
\q
```

---

## ğŸ“ æ–‡ä»¶æ“ä½œ

### æŸ¥çœ‹é¡¹ç›®ç›®å½•
```bash
cd /www/wwwroot/pyq-backend/pyq-backend
ls -la
```

### æŸ¥çœ‹å‰ç«¯ç›®å½•
```bash
cd /www/wwwroot/pyq-backend/pyq-frontend
ls -la
```

### æŸ¥çœ‹æ–‡ä»¶å†…å®¹
```bash
cat package.json
```

### æŸ¥çœ‹æ–‡ä»¶æœ€åå‡ è¡Œ
```bash
tail -n 20 /www/wwwlogs/pyq_backend.log
```

### å®æ—¶æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶
```bash
tail -f /www/wwwlogs/pyq_backend.log
```

### æŸ¥çœ‹ç£ç›˜ä½¿ç”¨æƒ…å†µ
```bash
df -h
```

### æŸ¥çœ‹ç›®å½•å¤§å°
```bash
du -sh /www/wwwroot/pyq-backend
```

### åˆ é™¤ä¸´æ—¶æ–‡ä»¶
```bash
rm -f /www/wwwroot/pyq-backend/pyq-backend/temp_image_*
```

---

## ğŸ“Š ç³»ç»Ÿç›‘æ§

### æŸ¥çœ‹ç³»ç»Ÿèµ„æº
```bash
top
```

### æŸ¥çœ‹å†…å­˜ä½¿ç”¨
```bash
free -h
```

### æŸ¥çœ‹CPUä½¿ç”¨
```bash
top -n 1
```

### æŸ¥çœ‹Node.jsè¿›ç¨‹
```bash
ps aux | grep node
```

### æŸ¥çœ‹Nginxè¿›ç¨‹
```bash
ps aux | grep nginx
```

### æŸ¥çœ‹ç³»ç»Ÿè´Ÿè½½
```bash
uptime
```

### æŸ¥çœ‹ç½‘ç»œè¿æ¥
```bash
netstat -an | grep ESTABLISHED
```

---

## ğŸ§ª æµ‹è¯•å‘½ä»¤

### æµ‹è¯•APIå¥åº·æ£€æŸ¥
```bash
curl http://127.0.0.1:3000/health
```

### æµ‹è¯•HTTPSè®¿é—®
```bash
curl https://autochat.lfdhk.com/api/health
```

### æµ‹è¯•we-mp-rssæœåŠ¡
```bash
curl http://127.0.0.1:8001/health
```

### æµ‹è¯•Nginxé…ç½®
```bash
nginx -t
```

---

## ğŸ”§ å¸¸è§é—®é¢˜æ’æŸ¥

### æœåŠ¡æ— æ³•å¯åŠ¨
```bash
# 1. æŸ¥çœ‹æ—¥å¿—
pm2 logs pyq-backend --lines 50

# 2. æ£€æŸ¥ç«¯å£å ç”¨
netstat -tlnp | grep :3000

# 3. æ£€æŸ¥Node.jsç‰ˆæœ¬
node -v

# 4. é‡å¯æœåŠ¡
pm2 restart pyq-backend
```

### 502é”™è¯¯
```bash
# 1. æ£€æŸ¥Node.jsæœåŠ¡æ˜¯å¦è¿è¡Œ
pm2 list

# 2. æ£€æŸ¥ç«¯å£æ˜¯å¦ç›‘å¬
netstat -tlnp | grep :3000

# 3. æŸ¥çœ‹Nginxé”™è¯¯æ—¥å¿—
tail -f /www/wwwlogs/pyq_backend.error.log

# 4. é‡å¯Nginx
nginx -s reload
```

### Dockerå®¹å™¨æ— æ³•å¯åŠ¨
```bash
# 1. æŸ¥çœ‹å®¹å™¨æ—¥å¿—
docker logs we-mp-rss

# 2. æ£€æŸ¥ç«¯å£å ç”¨
netstat -tlnp | grep :8001

# 3. åˆ é™¤å®¹å™¨é‡æ–°åˆ›å»º
docker rm we-mp-rss
docker run -d --name we-mp-rss -p 8001:8001 ...
```

---

## ğŸ“ å¿«æ·å‘½ä»¤ç»„åˆ

### å®Œæ•´é‡å¯æœåŠ¡
```bash
pm2 flush pyq-backend && pm2 restart pyq-backend && pm2 logs pyq-backend
```

### æŸ¥çœ‹æœåŠ¡çŠ¶æ€
```bash
pm2 list && netstat -tlnp | grep :3000 && docker ps
```

### æ¸…ç†ä¸´æ—¶æ–‡ä»¶å¹¶é‡å¯
```bash
rm -f /www/wwwroot/pyq-backend/pyq-backend/temp_image_* && pm2 restart pyq-backend
```

---

## ğŸ¯ é‡è¦æç¤º

1. **ä¿®æ”¹é…ç½®åè®°å¾—é‡å¯æœåŠ¡**
2. **æŸ¥çœ‹æ—¥å¿—æ—¶ä½¿ç”¨ Ctrl+C é€€å‡º**
3. **åˆ é™¤æ•°æ®å‰åŠ¡å¿…å¤‡ä»½**
4. **ä¿®æ”¹Nginxé…ç½®åæµ‹è¯•: `nginx -t`**
5. **PM2ä¿®æ”¹åä¿å­˜: `pm2 save`**

